!function(b){var a=function(d,c){this.options=b.extend({},b.fn.affix.defaults,c);this.$window=b(window).on("scroll.affix.data-api",b.proxy(this.checkPosition,this)).on("click.affix.data-api",b.proxy(function(){setTimeout(b.proxy(this.checkPosition,this),1)},this));this.$element=b(d);this.checkPosition()};a.prototype.checkPosition=function(){if(!this.$element.is(":visible")){return}var g=b(document).height(),i=this.$window.scrollTop(),c=this.$element.offset(),j=this.options.offset,e=j.bottom,f=j.top,h="affix affix-top affix-bottom",d;if(typeof j!="object"){e=f=j}if(typeof f=="function"){f=j.top()}if(typeof e=="function"){e=j.bottom()}d=this.unpin!=null&&(i+this.unpin<=c.top)?false:e!=null&&(c.top+this.$element.height()>=g-e)?"bottom":f!=null&&i<=f?"top":false;if(this.affixed===d){return}this.affixed=d;this.unpin=d=="bottom"?c.top-i:null;this.$element.removeClass(h).addClass("affix"+(d?"-"+d:""))};b.fn.affix=function(c){return this.each(function(){var f=b(this),e=f.data("affix"),d=typeof c=="object"&&c;if(!e){f.data("affix",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.affix.Constructor=a;b.fn.affix.defaults={offset:0};b(window).on("load",function(){b('[data-spy="affix"]').each(function(){var d=b(this),c=d.data();c.offset=c.offset||{};c.offsetBottom&&(c.offset.bottom=c.offsetBottom);c.offsetTop&&(c.offset.top=c.offsetTop);d.affix(c)})})}(window.jQuery);!function(c){var b='[data-dismiss="alert"]',a=function(d){c(d).on("click",b,this.close)};a.prototype.close=function(i){var h=c(this),f=h.attr("data-target"),g;if(!f){f=h.attr("href");f=f&&f.replace(/.*(?=#[^\s]*$)/,"")}g=c(f);i&&i.preventDefault();g.length||(g=h.hasClass("alert")?h:h.parent());g.trigger(i=c.Event("close"));if(i.isDefaultPrevented()){return}g.removeClass("in");function d(){g.trigger("closed").remove()}c.support.transition&&g.hasClass("fade")?g.on(c.support.transition.end,d):d()};c.fn.alert=function(d){return this.each(function(){var f=c(this),e=f.data("alert");if(!e){f.data("alert",(e=new a(this)))}if(typeof d=="string"){e[d].call(f)}})};c.fn.alert.Constructor=a;c(document).on("click.alert.data-api",b,a.prototype.close)}(window.jQuery);!function(b){var a=function(d,c){this.$element=b(d);this.options=b.extend({},b.fn.button.defaults,c)};a.prototype.setState=function(f){var h="disabled",c=this.$element,e=c.data(),g=c.is("input")?"val":"html";f=f+"Text";e.resetText||c.data("resetText",c[g]());c[g](e[f]||this.options[f]);setTimeout(function(){f=="loadingText"?c.addClass(h).attr(h,h):c.removeClass(h).removeAttr(h)},0)};a.prototype.toggle=function(){var c=this.$element.closest('[data-toggle="buttons-radio"]');c&&c.find(".active").removeClass("active");this.$element.toggleClass("active")};b.fn.button=function(c){return this.each(function(){var f=b(this),e=f.data("button"),d=typeof c=="object"&&c;if(!e){f.data("button",(e=new a(this,d)))}if(c=="toggle"){e.toggle()}else{if(c){e.setState(c)}}})};b.fn.button.defaults={loadingText:"loading..."};b.fn.button.Constructor=a;b(document).on("click.button.data-api","[data-toggle^=button]",function(d){var c=b(d.target);if(!c.hasClass("btn")){c=c.closest(".btn")}c.button("toggle")})}(window.jQuery);!function(a){var b=function(d,c){this.$element=a(d);this.options=c;this.options.slide&&this.slide(this.options.slide);this.options.pause=="hover"&&this.$element.on("mouseenter",a.proxy(this.pause,this)).on("mouseleave",a.proxy(this.cycle,this))};b.prototype={cycle:function(c){if(!c){this.paused=false}this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval));return this},to:function(g){var c=this.$element.find(".item.active"),d=c.parent().children(),e=d.index(c),f=this;if(g>(d.length-1)||g<0){return}if(this.sliding){return this.$element.one("slid",function(){f.to(g)})}if(e==g){return this.pause().cycle()}return this.slide(g>e?"next":"prev",a(d[g]))},pause:function(c){if(!c){this.paused=true}if(this.$element.find(".next, .prev").length&&a.support.transition.end){this.$element.trigger(a.support.transition.end);this.cycle()}clearInterval(this.interval);this.interval=null;return this},next:function(){if(this.sliding){return}return this.slide("next")},prev:function(){if(this.sliding){return}return this.slide("prev")},slide:function(j,d){var l=this.$element.find(".item.active"),c=d||l[j](),i=this.interval,k=j=="next"?"left":"right",f=j=="next"?"first":"last",g=this,h;this.sliding=true;i&&this.pause();c=c.length?c:this.$element.find(".item")[f]();h=a.Event("slide",{relatedTarget:c[0]});if(c.hasClass("active")){return}if(a.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(h);if(h.isDefaultPrevented()){return}c.addClass(j);c[0].offsetWidth;l.addClass(k);c.addClass(k);this.$element.one(a.support.transition.end,function(){c.removeClass([j,k].join(" ")).addClass("active");l.removeClass(["active",k].join(" "));g.sliding=false;setTimeout(function(){g.$element.trigger("slid")},0)})}else{this.$element.trigger(h);if(h.isDefaultPrevented()){return}l.removeClass("active");c.addClass("active");this.sliding=false;this.$element.trigger("slid")}i&&this.cycle();return this}};a.fn.carousel=function(c){return this.each(function(){var g=a(this),f=g.data("carousel"),d=a.extend({},a.fn.carousel.defaults,typeof c=="object"&&c),e=typeof c=="string"?c:d.slide;if(!f){g.data("carousel",(f=new b(this,d)))}if(typeof c=="number"){f.to(c)}else{if(e){f[e]()}else{if(d.interval){f.cycle()}}}})};a.fn.carousel.defaults={interval:5000,pause:"hover"};a.fn.carousel.Constructor=b;a(document).on("click.carousel.data-api","[data-slide]",function(h){var g=a(this),d,c=a(g.attr("data-target")||(d=g.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,"")),f=a.extend({},c.data(),g.data());c.carousel(f);h.preventDefault()})}(window.jQuery);!function(a){var b=function(d,c){this.$element=a(d);this.options=a.extend({},a.fn.collapse.defaults,c);if(this.options.parent){this.$parent=a(this.options.parent)}this.options.toggle&&this.toggle()};b.prototype={constructor:b,dimension:function(){var c=this.$element.hasClass("width");return c?"width":"height"},show:function(){var f,c,e,d;if(this.transitioning){return}f=this.dimension();c=a.camelCase(["scroll",f].join("-"));e=this.$parent&&this.$parent.find("> .accordion-group > .in");if(e&&e.length){d=e.data("collapse");if(d&&d.transitioning){return}e.collapse("hide");d||e.data("collapse",null)}this.$element[f](0);this.transition("addClass",a.Event("show"),"shown");a.support.transition&&this.$element[f](this.$element[0][c])},hide:function(){var c;if(this.transitioning){return}c=this.dimension();this.reset(this.$element[c]());this.transition("removeClass",a.Event("hide"),"hidden");this.$element[c](0)},reset:function(c){var d=this.dimension();this.$element.removeClass("collapse")[d](c||"auto")[0].offsetWidth;this.$element[c!==null?"addClass":"removeClass"]("collapse");return this},transition:function(g,d,e){var f=this,c=function(){if(d.type=="show"){f.reset()}f.transitioning=0;f.$element.trigger(e)};this.$element.trigger(d);if(d.isDefaultPrevented()){return}this.transitioning=1;this.$element[g]("in");a.support.transition&&this.$element.hasClass("collapse")?this.$element.one(a.support.transition.end,c):c()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};a.fn.collapse=function(c){return this.each(function(){var f=a(this),e=f.data("collapse"),d=typeof c=="object"&&c;if(!e){f.data("collapse",(e=new b(this,d)))}if(typeof c=="string"){e[c]()}})};a.fn.collapse.defaults={toggle:true};a.fn.collapse.Constructor=b;a(document).on("click.collapse.data-api","[data-toggle=collapse]",function(h){var g=a(this),c,f=g.attr("data-target")||h.preventDefault()||(c=g.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,""),d=a(f).data("collapse")?"toggle":g.data();g[a(f).hasClass("in")?"addClass":"removeClass"]("collapsed");a(f).collapse(d)})}(window.jQuery);!function(e){var b="[data-toggle=dropdown]",a=function(g){var f=e(g).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){f.parent().removeClass("open")})};a.prototype={constructor:a,toggle:function(i){var h=e(this),g,f;if(h.is(".disabled, :disabled")){return}g=d(h);f=g.hasClass("open");c();if(!f){g.toggleClass("open");h.focus()}return false},keydown:function(k){var j,l,f,i,h,g;if(!/(38|40|27)/.test(k.keyCode)){return}j=e(this);k.preventDefault();k.stopPropagation();if(j.is(".disabled, :disabled")){return}i=d(j);h=i.hasClass("open");if(!h||(h&&k.keyCode==27)){return j.click()}l=e("[role=menu] li:not(.divider) a",i);if(!l.length){return}g=l.index(l.filter(":focus"));if(k.keyCode==38&&g>0){g--}if(k.keyCode==40&&g<l.length-1){g++}if(!~g){g=0}l.eq(g).focus()}};function c(){e(b).each(function(){d(e(this)).removeClass("open")})}function d(h){var f=h.attr("data-target"),g;if(!f){f=h.attr("href");f=f&&/#/.test(f)&&f.replace(/.*(?=#[^\s]*$)/,"")}g=e(f);g.length||(g=h.parent());return g}e.fn.dropdown=function(f){return this.each(function(){var h=e(this),g=h.data("dropdown");if(!g){h.data("dropdown",(g=new a(this)))}if(typeof f=="string"){g[f].call(h)}})};e.fn.dropdown.Constructor=a;e(document).on("click.dropdown.data-api touchstart.dropdown.data-api",c).on("click.dropdown touchstart.dropdown.data-api",".dropdown form",function(f){f.stopPropagation()}).on("click.dropdown.data-api touchstart.dropdown.data-api",b,a.prototype.toggle).on("keydown.dropdown.data-api touchstart.dropdown.data-api",b+", [role=menu]",a.prototype.keydown)}(window.jQuery);!function(b){var a=function(d,c){this.options=c;this.$element=b(d).delegate('[data-dismiss="modal"]',"click.dismiss.modal",b.proxy(this.hide,this));this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};a.prototype={constructor:a,toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var c=this,d=b.Event("show");this.$element.trigger(d);if(this.isShown||d.isDefaultPrevented()){return}this.isShown=true;this.escape();this.backdrop(function(){var e=b.support.transition&&c.$element.hasClass("fade");if(!c.$element.parent().length){c.$element.appendTo(document.body)}c.$element.show();if(e){c.$element[0].offsetWidth}c.$element.addClass("in").attr("aria-hidden",false);c.enforceFocus();e?c.$element.one(b.support.transition.end,function(){c.$element.focus().trigger("shown")}):c.$element.focus().trigger("shown")})},hide:function(d){d&&d.preventDefault();var c=this;d=b.Event("hide");this.$element.trigger(d);if(!this.isShown||d.isDefaultPrevented()){return}this.isShown=false;this.escape();b(document).off("focusin.modal");this.$element.removeClass("in").attr("aria-hidden",true);b.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()},enforceFocus:function(){var c=this;b(document).on("focusin.modal",function(d){if(c.$element[0]!==d.target&&!c.$element.has(d.target).length){c.$element.focus()}})},escape:function(){var c=this;if(this.isShown&&this.options.keyboard){this.$element.on("keyup.dismiss.modal",function(d){d.which==27&&c.hide()})}else{if(!this.isShown){this.$element.off("keyup.dismiss.modal")}}},hideWithTransition:function(){var c=this,d=setTimeout(function(){c.$element.off(b.support.transition.end);c.hideModal()},500);this.$element.one(b.support.transition.end,function(){clearTimeout(d);c.hideModal()})},hideModal:function(c){this.$element.hide().trigger("hidden");this.backdrop()},removeBackdrop:function(){this.$backdrop.remove();this.$backdrop=null},backdrop:function(f){var e=this,d=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var c=b.support.transition&&d;this.$backdrop=b('<div class="modal-backdrop '+d+'" />').appendTo(document.body);this.$backdrop.click(this.options.backdrop=="static"?b.proxy(this.$element[0].focus,this.$element[0]):b.proxy(this.hide,this));if(c){this.$backdrop[0].offsetWidth}this.$backdrop.addClass("in");c?this.$backdrop.one(b.support.transition.end,f):f()}else{if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");b.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(b.support.transition.end,b.proxy(this.removeBackdrop,this)):this.removeBackdrop()}else{if(f){f()}}}}};b.fn.modal=function(c){return this.each(function(){var f=b(this),e=f.data("modal"),d=b.extend({},b.fn.modal.defaults,f.data(),typeof c=="object"&&c);if(!e){f.data("modal",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}else{if(d.show){e.show()}}})};b.fn.modal.defaults={backdrop:true,keyboard:true,show:true};b.fn.modal.Constructor=a;b(document).on("click.modal.data-api",'[data-toggle="modal"]',function(h){var g=b(this),d=g.attr("href"),c=b(g.attr("data-target")||(d&&d.replace(/.*(?=#[^\s]+$)/,""))),f=c.data("modal")?"toggle":b.extend({remote:!/#/.test(d)&&d},c.data(),g.data());h.preventDefault();c.modal(f).one("hide",function(){g.focus()})})}(window.jQuery);!function(b){function a(f,e){var g=b.proxy(this.process,this),c=b(f).is("body")?b(window):b(f),d;this.options=b.extend({},b.fn.scrollspy.defaults,e);this.$scrollElement=c.on("scroll.scroll-spy.data-api",g);this.selector=(this.options.target||((d=b(f).attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""))||"")+" .nav li > a";this.$body=b("body");this.refresh();this.process()}a.prototype={constructor:a,refresh:function(){var c=this,d;this.offsets=b([]);this.targets=b([]);d=this.$body.find(this.selector).map(function(){var f=b(this),e=f.data("target")||f.attr("href"),g=/^#\w/.test(e)&&b(e);return(g&&g.length&&[[g.position().top,e]])||null}).sort(function(f,e){return f[0]-e[0]}).each(function(){c.offsets.push(this[0]);c.targets.push(this[1])})},process:function(){var h=this.$scrollElement.scrollTop()+this.options.offset,e=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,g=e-this.$scrollElement.height(),f=this.offsets,c=this.targets,j=this.activeTarget,d;if(h>=g){return j!=(d=c.last()[0])&&this.activate(d)}for(d=f.length;d--;){j!=c[d]&&h>=f[d]&&(!f[d+1]||h<=f[d+1])&&this.activate(c[d])}},activate:function(e){var d,c;this.activeTarget=e;b(this.selector).parent(".active").removeClass("active");c=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]';d=b(c).parent("li").addClass("active");if(d.parent(".dropdown-menu").length){d=d.closest("li.dropdown").addClass("active")}d.trigger("activate")}};b.fn.scrollspy=function(c){return this.each(function(){var f=b(this),e=f.data("scrollspy"),d=typeof c=="object"&&c;if(!e){f.data("scrollspy",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.scrollspy.Constructor=a;b.fn.scrollspy.defaults={offset:10};b(window).on("load",function(){b('[data-spy="scroll"]').each(function(){var c=b(this);c.scrollspy(c.data())})})}(window.jQuery);!function(b){var a=function(c){this.element=b(c)};a.prototype={constructor:a,show:function(){var i=this.element,f=i.closest("ul:not(.dropdown-menu)"),d=i.attr("data-target"),g,c,h;if(!d){d=i.attr("href");d=d&&d.replace(/.*(?=#[^\s]*$)/,"")}if(i.parent("li").hasClass("active")){return}g=f.find(".active:last a")[0];h=b.Event("show",{relatedTarget:g});i.trigger(h);if(h.isDefaultPrevented()){return}c=b(d);this.activate(i.parent("li"),f);this.activate(c,c.parent(),function(){i.trigger({type:"shown",relatedTarget:g})})},activate:function(e,d,h){var c=d.find("> .active"),g=h&&b.support.transition&&c.hasClass("fade");function f(){c.removeClass("active").find("> .dropdown-menu > .active").removeClass("active");e.addClass("active");if(g){e[0].offsetWidth;e.addClass("in")}else{e.removeClass("fade")}if(e.parent(".dropdown-menu")){e.closest("li.dropdown").addClass("active")}h&&h()}g?c.one(b.support.transition.end,f):f();c.removeClass("in")}};b.fn.tab=function(c){return this.each(function(){var e=b(this),d=e.data("tab");if(!d){e.data("tab",(d=new a(this)))}if(typeof c=="string"){d[c]()}})};b.fn.tab.Constructor=a;b(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(c){c.preventDefault();b(this).tab("show")})}(window.jQuery);!function(b){var a=function(d,c){this.init("tooltip",d,c)};a.prototype={constructor:a,init:function(f,e,d){var g,c;this.type=f;this.$element=b(e);this.options=this.getOptions(d);this.enabled=true;if(this.options.trigger=="click"){this.$element.on("click."+this.type,this.options.selector,b.proxy(this.toggle,this))}else{if(this.options.trigger!="manual"){g=this.options.trigger=="hover"?"mouseenter":"focus";c=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(g+"."+this.type,this.options.selector,b.proxy(this.enter,this));this.$element.on(c+"."+this.type,this.options.selector,b.proxy(this.leave,this))}}this.options.selector?(this._options=b.extend({},this.options,{trigger:"manual",selector:""})):this.fixTitle()},getOptions:function(c){c=b.extend({},b.fn[this.type].defaults,c,this.$element.data());if(c.delay&&typeof c.delay=="number"){c.delay={show:c.delay,hide:c.delay}}return c},enter:function(d){var c=b(d.currentTarget)[this.type](this._options).data(this.type);if(!c.options.delay||!c.options.delay.show){return c.show()}clearTimeout(this.timeout);c.hoverState="in";this.timeout=setTimeout(function(){if(c.hoverState=="in"){c.show()}},c.options.delay.show)},leave:function(d){var c=b(d.currentTarget)[this.type](this._options).data(this.type);if(this.timeout){clearTimeout(this.timeout)}if(!c.options.delay||!c.options.delay.hide){return c.hide()}c.hoverState="out";this.timeout=setTimeout(function(){if(c.hoverState=="out"){c.hide()}},c.options.delay.hide)},show:function(){var g,c,i,e,h,d,f;if(this.hasContent()&&this.enabled){g=this.tip();this.setContent();if(this.options.animation){g.addClass("fade")}d=typeof this.options.placement=="function"?this.options.placement.call(this,g[0],this.$element[0]):this.options.placement;c=/in/.test(d);g.detach().css({top:0,left:0,display:"block"}).insertAfter(this.$element);i=this.getPosition(c);e=g[0].offsetWidth;h=g[0].offsetHeight;switch(c?d.split(" ")[1]:d){case"bottom":f={top:i.top+i.height,left:i.left+i.width/2-e/2};break;case"top":f={top:i.top-h,left:i.left+i.width/2-e/2};break;case"left":f={top:i.top+i.height/2-h/2,left:i.left-e};break;case"right":f={top:i.top+i.height/2-h/2,left:i.left+i.width};break}g.offset(f).addClass(d).addClass("in")}},setContent:function(){var d=this.tip(),c=this.getTitle();d.find(".tooltip-inner")[this.options.html?"html":"text"](c);d.removeClass("fade in top bottom left right")},hide:function(){var c=this,d=this.tip();d.removeClass("in");function e(){var f=setTimeout(function(){d.off(b.support.transition.end).detach()},500);d.one(b.support.transition.end,function(){clearTimeout(f);d.detach()})}b.support.transition&&this.$tip.hasClass("fade")?e():d.detach();return this},fixTitle:function(){var c=this.$element;if(c.attr("title")||typeof(c.attr("data-original-title"))!="string"){c.attr("data-original-title",c.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(c){return b.extend({},(c?{top:0,left:0}:this.$element.offset()),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,c=this.$element,d=this.options;e=c.attr("data-original-title")||(typeof d.title=="function"?d.title.call(c[0]):d.title);return e},tip:function(){return this.$tip=this.$tip||b(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(d){var c=b(d.currentTarget)[this.type](this._options).data(this.type);c[c.tip().hasClass("in")?"hide":"show"]()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};b.fn.tooltip=function(c){return this.each(function(){var f=b(this),e=f.data("tooltip"),d=typeof c=="object"&&c;if(!e){f.data("tooltip",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.tooltip.Constructor=a;b.fn.tooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0,html:false}}(window.jQuery);!function(b){var a=function(d,c){this.init("popover",d,c)};a.prototype=b.extend({},b.fn.tooltip.Constructor.prototype,{constructor:a,setContent:function(){var e=this.tip(),d=this.getTitle(),c=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](d);e.find(".popover-content > *")[this.options.html?"html":"text"](c);e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var d,c=this.$element,e=this.options;d=c.attr("data-content")||(typeof e.content=="function"?e.content.call(c[0]):e.content);return d},tip:function(){if(!this.$tip){this.$tip=b(this.options.template)}return this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});b.fn.popover=function(c){return this.each(function(){var f=b(this),e=f.data("popover"),d=typeof c=="object"&&c;if(!e){f.data("popover",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.popover.Constructor=a;b.fn.popover.defaults=b.extend({},b.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery);!function(a){a(function(){a.support.transition=(function(){var b=(function(){var e=document.createElement("bootstrap"),d={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},c;for(c in d){if(e.style[c]!==undefined){return d[c]}}}());return b&&{end:b}})()})}(window.jQuery);!function(a){var b=function(d,c){this.$element=a(d);this.options=a.extend({},a.fn.typeahead.defaults,c);this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.updater=this.options.updater||this.updater;this.$menu=a(this.options.menu).appendTo("body");this.source=this.options.source;this.shown=false;this.listen()};b.prototype={constructor:b,select:function(){var c=this.$menu.find(".active").attr("data-value");this.$element.val(this.updater(c)).change();return this.hide()},updater:function(c){return c},show:function(){var c=a.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});this.$menu.css({top:c.top+c.height,left:c.left});this.$menu.show();this.shown=true;return this},hide:function(){this.$menu.hide();this.shown=false;return this},lookup:function(d){var c;this.query=this.$element.val();if(!this.query||this.query.length<this.options.minLength){return this.shown?this.hide():this}c=a.isFunction(this.source)?this.source(this.query,a.proxy(this.process,this)):this.source;return c?this.process(c):this},process:function(c){var d=this;c=a.grep(c,function(e){return d.matcher(e)});c=this.sorter(c);if(!c.length){return this.shown?this.hide():this}return this.render(c.slice(0,this.options.items)).show()},matcher:function(c){return ~c.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){var f=[],d=[],c=[],g;while(g=e.shift()){if(!g.toLowerCase().indexOf(this.query.toLowerCase())){f.push(g)}else{if(~g.indexOf(this.query)){d.push(g)}else{c.push(g)}}}return f.concat(d,c)},highlighter:function(c){var d=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return c.replace(new RegExp("("+d+")","ig"),function(e,f){return"<strong>"+f+"</strong>"})},render:function(c){var d=this;c=a(c).map(function(e,f){e=a(d.options.item).attr("data-value",f);e.find("a").html(d.highlighter(f));return e[0]});c.first().addClass("active");this.$menu.html(c);return this},next:function(d){var e=this.$menu.find(".active").removeClass("active"),c=e.next();if(!c.length){c=a(this.$menu.find("li")[0])}c.addClass("active")},prev:function(d){var e=this.$menu.find(".active").removeClass("active"),c=e.prev();if(!c.length){c=this.$menu.find("li").last()}c.addClass("active")},listen:function(){this.$element.on("blur",a.proxy(this.blur,this)).on("keypress",a.proxy(this.keypress,this)).on("keyup",a.proxy(this.keyup,this));if(this.eventSupported("keydown")){this.$element.on("keydown",a.proxy(this.keydown,this))}this.$menu.on("click",a.proxy(this.click,this)).on("mouseenter","li",a.proxy(this.mouseenter,this))},eventSupported:function(c){var d=c in this.$element;if(!d){this.$element.setAttribute(c,"return;");d=typeof this.$element[c]==="function"}return d},move:function(c){if(!this.shown){return}switch(c.keyCode){case 9:case 13:case 27:c.preventDefault();break;case 38:c.preventDefault();this.prev();break;case 40:c.preventDefault();this.next();break}c.stopPropagation()},keydown:function(c){this.suppressKeyPressRepeat=!~a.inArray(c.keyCode,[40,38,9,13,27]);this.move(c)},keypress:function(c){if(this.suppressKeyPressRepeat){return}this.move(c)},keyup:function(c){switch(c.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown){return}this.select();break;case 27:if(!this.shown){return}this.hide();break;default:this.lookup()}c.stopPropagation();c.preventDefault()},blur:function(d){var c=this;setTimeout(function(){c.hide()},150)},click:function(c){c.stopPropagation();c.preventDefault();this.select()},mouseenter:function(c){this.$menu.find(".active").removeClass("active");a(c.currentTarget).addClass("active")}};a.fn.typeahead=function(c){return this.each(function(){var f=a(this),e=f.data("typeahead"),d=typeof c=="object"&&c;if(!e){f.data("typeahead",(e=new b(this,d)))}if(typeof c=="string"){e[c]()}})};a.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1};a.fn.typeahead.Constructor=b;a(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(d){var c=a(this);if(c.data("typeahead")){return}d.preventDefault();c.typeahead(c.data())})}(window.jQuery);window.JST=window.JST||{};window.JST.sign_up=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<div class="container container-other">\n  <div class="row">\n    <div class="span4 offset4 well">\n      <legend>Create new account</legend>\n      <div id="sign-up-alert" class="alert alert-error hide">\n        <a class="close" data-dismiss="alert" href="#">×</a>Duplicate username or password!\n      </div>\n      <form>\n        <input type="text" id="email" class="span4" name="email" placeholder="brogrammer@castle.com">\n        <input type="text" id="username" class="span4" name="username" placeholder="username">\n        <input type="password" id="password" class="span4" name="password" placeholder="password">\n        <button type="submit" id="sign-up-btn" name="submit" class="btn btn-info btn-block">Sign up</button>\n      </form>\n      <div>\n        <a id="sign-in-btn" href="/sign-in" class="pull-right"><i class="icon-signin"></i> Sign in</a>\n      </div>\n    </div>\n  </div>\n</div>\n';return e};window.JST.level=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<section id="level">\n  <header>\n    <h1>Level <span class="pull-right"><span class="muted">ID:</span>'+((b=(c.level.id))==null?"":b)+'</span></h1>\n  </header>\n  <div id="level-edit"></div>\n</section>\n';return e};window.JST.toast=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<div class="alert';if(c.title!=null){e+=" alert-block"}e+="";if(c.type!="warning"){e+=" alert-"+((b=(c.type))==null?"":b)+""}e+='">\n    <button type="button" class="close" data-dismiss="alert">&times;</button>\n    ';if(c.title!=null){e+="\n    <h4>"+((b=(c.title))==null?"":b)+"</h4>\n    "}e+="\n    ";if(c.content!=null){e+="\n    "+((b=(c.content))==null?"":b)+"\n    "}e+="\n</div>\n";return e};window.JST.main=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<div id="top-nav"></div>\n<div id="toast" class="toast"></div>\n<div class="container container-main">\n    <div class="row-fluid">\n        <div id="side-nav" class="span3"></div>\n        <div id="content-wrapper" class="span9">\n            <div id="content"></div>\n        </div>\n    </div>\n</div>\n';return e};window.JST.users_list=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+="";if(c.users.length){e+='\n<ul class="media-list">\n';c.users.forEach(function(f){e+="\n  "+((b=(c.templates.item({user:f})))==null?"":b)+"\n"});e+='\n</ul>\n<div class="pagination-centered">\n  <button id="more-btn" class="btn';if(c.users.pagination.itemsTotal==c.users.length){e+=" hide"}e+='"><i class="icon-double-angle-down"></i> More</button>\n</div>\n'}else{e+='\n<p class="info pagination-centered">No users found.</p>\n'}e+="\n";return e};window.JST.levels_list=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+="";if(c.levels.length){e+='\n<ul id="levels-list" class="media-list">\n\n<li id="level-select-all" class="media">\n  <div class="media-body">\n    <button id="levels-select-all-btn" class="btn btn-primary" data-toggle="button" >Select all</button>\n  </div>\n</li>\n\n';c.levels.forEach(function(f){e+="\n  "+((b=(c.templates.item({level:f})))==null?"":b)+"\n"});e+='\n\n</ul>\n<div class="pagination-centered">\n  <button id="more-btn" class="btn';if(c.levels.pagination.itemsTotal==c.levels.length){e+=" hide"}e+='"><i class="icon-double-angle-down"></i> More</button>\n</div>\n'}else{e+='\n<p class="info pagination-centered">No levels found.</p>\n'}e+="\n";return e};window.JST.dashboard=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<section id="dashboard">\n  <header>\n    <div class="pull-right">\n      <button id="refresh-btn" class="btn"><i class="icon-refresh"></i> Refresh</button>\n    </div>\n    <h1>Dashboard</h1>\n  </header>\n</section>\n<section id="levels-stats">\n</section>\n';return e};window.JST.levels_list_item=function(d){var c,f="",b=Array.prototype.join,e=function(){f+=b.call(arguments,"")};f+='<li id="level-'+((c=(d.level.id))==null?"":c)+'" class="media">\n  <label class="pull-left" for="colors-1-toggle-'+((c=(d.level.id))==null?"":c)+'">\n    <input class="checkbox" type="checkbox" id="levels-toggle-'+((c=(d.level.id))==null?"":c)+'" name="levels-'+((c=(d.level.id))==null?"":c)+'" value="'+((c=(d.level.id))==null?"":c)+'" />\n  </label>\n  <a class="pull-left thumbnail" href="/levels/'+((c=(d.level.id))==null?"":c)+'" data-c-uri="levels/'+((c=(d.level.id))==null?"":c)+'">\n    ';var g=d.level.has("thumbnails")?"https://"+d.level.get("thumbnails")["default"]:"/assets/images/placeholder_60.png";f+='\n    <img class="media-object" src="'+((c=(g))==null?"":c)+'" width=60 height=60>\n  </a>\n  <div class="media-body">\n    <h4 class="media-heading"><a class="name" href="/levels/'+((c=(d.level.id))==null?"":c)+'" data-c-uri="levels/'+((c=(d.level.id))==null?"":c)+'">'+((c=(d.level.get("name")))==null?"":_.escape(c))+"</a></h4>\n    ";var a=d.level.get("owner")||{id:"undefined"};f+='\n    <p class="description">'+((c=(d.level.get("description")))==null?"":_.escape(c))+'</p>\n    <p>By <a href="/users/'+((c=(a.id))==null?"":c)+'" data-c-uri="users/'+((c=(a.id))==null?"":c)+'">'+((c=(a.displayname))==null?"":c)+"</a></p>\n\n    ";flags=d.level.get("flags")||[];if(flags.length>0){f+="\n    <p>Flags:"+((c=(flags))==null?"":c)+"</p>\n    "}f+="\n\n\n  </div>\n</li>\n";return f};window.JST.user_edit=function(c){var b,f="",a=Array.prototype.join,d=function(){f+=a.call(arguments,"")};f+='<div class="row-fluid">\n  <div class="span12">\n    <form class="form-horizontal">\n      <div class="control-group">\n        <label class="control-label" for="username">Username</label>\n        <div class="controls">\n          <input id="username" class="input-large" type="text" value="'+((b=(c.user.get("username")))==null?"":b)+'"/>\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label" for="displayname">Displayname</label>\n        <div class="controls">\n          <span id="displayname" class="input-large uneditable-input">'+((b=(c.user.get("displayname")))==null?"":b)+'</span>\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label" for="password">Password</label>\n        <div class="controls">\n          <input type="password" id="password" class="input-large" name="password" placeholder="password">\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label" for="email">E-mail</label>\n        <div class="controls">\n          <input id="email" class="input-large" type="text" value="'+((b=(c.user.get("email")))==null?"":b)+'"/>\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label" for="Roles">Roles</label>\n        <div class="controls">\n          ';var e=c.user.get("roles")||[];f+='\n          <input id="roles" class="input-large" type="text" value="'+((b=(e.join(", ")))==null?"":b)+'" placeholder="Comma-separated list of roles"/>\n        </div>\n      </div>\n    </form>\n  </div>\n</div>\n<div class="form-actions">\n  <button id="save-btn" class="btn btn-primary">Save changes</button>\n  <button id="cancel-btn" class="btn">Cancel</button>\n  <button id="delete-btn" class="btn btn-danger pull-right">Delete forever</button>\n</div>\n';return f};window.JST.level_new_dialog=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<div class="modal">\n  <div class="modal-header">\n    <h3>New Level</h3>\n      <div id="level-new-alert" class="alert alert-error hide">\n        <a class="close" data-dismiss="alert" href="#">�</a>Duplicate levelname!\n      </div>\n  </div>\n  <div class="modal-body form-stacked">\n\n<div class="row-fluid">\n  <div class="span12">\n    <form id="new-level-form" data-remote="true" method="post" enctype="multipart/form-data"  class="form-horizontal">\n\n      <div class="control-group">\n        <label class="control-label" for="name">Name</label>\n        <div class="controls">\n          <input id="level-name" class="input-large" type="text" value=""/>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="description">Description</label>\n        <div class="controls">\n          <input id="level-description" class="input-large" type="text" value=""/>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="gameplay">Gameplay</label>\n        <div class="controls">\n          <input id="level-gameplay" class="input-large" type="text" value=""/>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="tags">Tags</label>\n        <div class="controls">\n          <input id="level-tags" class="input-large" type="text" value=""/>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="flags">Flags</label>\n        <div class="controls">\n          <input id="level-flags" class="input-large" type="text" value=""/>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="level-owner">Owner</label>\n        <div class="controls">\n          <input id="level-owner" class="input-large" type="text" value=""/>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="visibility">Visibility</label>\n        <div class="controls"> \n        <div id="level-visibility" class="btn-group" data-toggle="buttons-radio">\n            <button type="button" value="private" class="btn btn-primary active">Private</button>\n            <button type="button" value="friends" class="btn btn-primary">Friends</button>\n            <button type="button" value="public" class="btn btn-primary">Public</button>\n            <button type="button" value="story" class="btn btn-primary">Story</button>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="levelData">Level Data</label>\n        <div class="controls"> \n            <input id="level-file" class="input-large" type="file" multiple />\n        </div>\n      </div>\n\n      </div>\n    </form>\n  </div>\n</div>\n\n  </div>\n  <div class="modal-footer">\n    <button id="level-new-create-btn" class="btn btn-primary">Create</button>\n    <button id="level-new-close-btn" class="btn">Cancel</button>\n  </div>\n</div>\n\n\n\n\n';return e};window.JST.user=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<section id="user">\n  <header>\n    <h1>User <span class="pull-right"><span class="muted">ID:</span>'+((b=(c.user.id))==null?"":b)+'</span></h1>\n  </header>\n  <div id="user-edit"></div>\n</section>\n';return e};window.JST.levels_stats=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<div class="row-fluid">\n\n    <div class="span2">\n        <div class="kpi">'+((b=(c.stats.users.users.total))==null?"":b)+'</div>\n        <div><small>total users</small></div>\n    </div>\n    <div class="span2">\n        <div class="kpi">'+((b=(c.stats.levels.levels.total))==null?"":b)+'</div>\n        <div><small>total levels</small></div>\n    </div>\n    <div class="span2">\n        <div class="kpi">'+((b=(c.stats.levels.downloads))==null?"":b)+'</div>\n        <div><small>total downloads</small></div>\n    </div>\n    <div class="span2">\n        <div class="kpi">'+((b=(c.stats.levels.comments))==null?"":b)+'</div>\n        <div><small>total comments</small></div>\n    </div>\n    <div class="span2">\n        <div class="kpi">'+((b=(c.stats.levels.likes))==null?"":b)+'</div>\n        <div><small>total likes</small></div>\n    </div>\n    <div class="span2">\n        <div class="kpi">'+((b=(c.stats.levels.plays))==null?"":b)+'</div>\n        <div><small>total plays</small></div>\n    </div>\n    <div class="span2">\n        <div class="kpi">'+((b=(c.stats.levels.panics))==null?"":b)+"</div>\n        <div><small>total panics</small></div>\n    </div>\n\n</div>\n";_.each([{cat:"downloaded",stat:"downloads"},{cat:"played",stat:"plays"},{cat:"commented",stat:"comments"},{cat:"liked",stat:"likes"},{cat:"panic",stat:"panics"}],function(f){e+='\n<div class="sub-header">\n    <h2>Most '+((b=(f.cat))==null?"":b)+'</h2>\n</div>\n<div class="row-fluid row-fluid-alternate-bg">\n    <div class="span12">\n        <ul class="numbered-list">\n            ';_.each(c.stats.levels.levels["most_"+f.cat],function(g){e+="\n            <li><strong>"+((b=(g[f.stat]))==null?"":b)+'</strong><a class="level-link" href="/levels/'+((b=(g.id))==null?"":b)+'" data-c-uri="levels/'+((b=(g.id))==null?"":b)+'">'+((b=(g.name))==null?"":_.escape(b))+"</a>\n            "});e+="\n        </ul>\n    </div>\n</div>\n"});e+="\n";return e};window.JST.forbidden=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<div class="container container-other">\n  <div class="row">\n    <div class="span4 offset4 well">\n        <legend>Forbidden</legend>\n        <p>Only Castle administrators can access the console. <a id="sign-in-btn" href="/sign-in">Sign in</a> or <a id="sign-up-btn" href="/sign-up">create new account</a>.</p>\n    </div>\n  </div>\n</div>\n';return e};window.JST.users_list_item=function(k){var g,j="",l=Array.prototype.join,a=function(){j+=l.call(arguments,"")};j+='<li id="user-'+((g=(k.user.id))==null?"":g)+'" class="media">\n  <a class="pull-left thumbnail" href="/users/'+((g=(k.user.id))==null?"":g)+'" data-c-uri="users/'+((g=(k.user.id))==null?"":g)+'">\n    ';var b=k.user.has("thumbnails")?"https://"+k.user.get("thumbnails")["256"]:"/assets/images/placeholder_60.png";j+='\n    <img class="media-object" src="'+((g=(b))==null?"":g)+'" width=60 height=60>\n  </a>\n  <div class="media-body">\n    ';var h=k.user.get("email"),d=k.user.get("username");j+='\n    <h4 class="media-heading">\n        <a class="login" href="/users/'+((g=(k.user.id))==null?"":g)+'" data-c-uri="users/'+((g=(k.user.id))==null?"":g)+'">';if(d){j+=""+((g=(d))==null?"":_.escape(g))+""}else{j+=""+((g=(h))==null?"":_.escape(g))+""}j+='</a>\n        <span class="login-secondary muted">';if(d&&h){j+="("+((g=(h))==null?"":_.escape(g))+")"}j+='</span>\n        <a href="/users/'+((g=(k.user.id))==null?"":g)+'" data-c-uri="users/'+((g=(k.user.id))==null?"":g)+'/levels" title="Show levels"><i class="icon-folder-close"></i></a>\n    </h4>\n    ';var e=k.user.get("roles")||[];j+="\n    <p>";for(var c=0,f=e.length;c<f;c++){j+='<span class="label';if(e[c]=="admin"){j+=" label-important"}j+='">'+((g=(e[c]))==null?"":g)+"</span> "}j+="</p>\n  </div>\n</li>\n";return j};window.JST.user_new_dialog=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<div class="modal">\n  <div class="modal-header">\n    <h3>New User</h3>\n\n      <div id="user-new-alert" class="alert alert-error hide">\n        <a class="close" data-dismiss="alert" href="#">�</a>Duplicate username or password!\n      </div>\n\n\n  </div>\n  <div class="modal-body form-stacked">\n\n\n<div class="row-fluid">\n  <div class="span12">\n    <form class="form-horizontal">\n      <div class="control-group">\n        <label class="control-label" for="username">Username</label>\n        <div class="controls">\n          <input id="username" class="input-large" type="text" value=""/>\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label" for="email">E-mail</label>\n        <div class="controls">\n          <input id="email" class="input-large" type="text" value=""/>\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label" for="password">Password</label>\n        <div class="controls">\n          <input type="password" id="password" class="input-large" name="password" placeholder="password">\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label" for="Roles">Roles</label>\n        <div class="controls">\n        <div id="user-new-roles" class="btn-group" data-toggle="buttons-checkbox">\n            <button type="button" value="user" class="btn btn-primary active">User</button>\n            <button type="button" value="admin" class="btn btn-primary">Admin</button>\n            <button type="button" value="console" class="btn btn-primary">Console</button>\n        </div>\n      </div>\n      </div>\n    </form>\n  </div>\n</div>\n\n  </div>\n  <div class="modal-footer">\n    <button id="user-new-create-btn" class="btn btn-primary">Create</button>\n    <button id="user-new-close-btn" class="btn">Cancel</button>\n  </div>\n</div>\n\n\n\n\n';return e};window.JST.sign_in=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<div class="container container-other">\n  <div class="row">\n    <div class="span4 offset4 well">\n      <legend>Please Sign In, Bro</legend>\n      <div id="sign-in-alert" class="alert alert-error hide">\n        <a class="close" data-dismiss="alert" href="#">×</a>Incorrect email or password!\n      </div>\n      <form>\n        <input type="text" id="login" class="span4" name="login" placeholder="brogrammer@castle.com">\n        <input type="password" id="password" class="span4" name="password" placeholder="password">\n        <button type="submit" id="sign-in-btn" name="submit" class="btn btn-info btn-block">Sign in</button>\n      </form>\n      <div>\n        <a id="sign-up-btn" href="/sign-up" class="pull-right"><i class="icon-user"></i> Create new account</a>\n      </div>\n    </div>\n  </div>\n</div>\n';return e};window.JST.level_edit=function(h){var f,g="",j=Array.prototype.join,a=function(){g+=j.call(arguments,"")};g+='<div class="row-fluid">\n  <div class="span8">\n    <form class="form-horizontal">\n      <div class="control-group">\n        <label class="control-label" for="name">Name</label>\n        <div class="controls">\n          <input id="name" class="input-large" type="text" value="'+((f=(h.level.get("name")))==null?"":f)+'"/>\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label" for="description">Description</label>\n        <div class="controls">\n          <textarea id="description" class="input-large" rows="3">'+((f=(h.level.get("description")))==null?"":f)+'</textarea>\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label" for="gameplay">Gameplay</label>\n        <div class="controls">\n          <input id="gameplay" class="input-large" type="text" value="'+((f=(h.level.get("gameplay")))==null?"":f)+'"/>\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label" for="visibility">Visibility</label>\n        <div class="controls">\n          <select id="visibility" class="input-large">\n            ';var b=h.level.get("visibility");g+='\n            <option value="private"';if(b=="private"){g+=" selected"}g+='>Private</option>\n            <option value="friends"';if(b=="friends"){g+=" selected"}g+='>Friends</option>\n            <option value="public"';if(b=="public"){g+=" selected"}g+='>Public</option>\n            <option value="story"';if(b=="story"){g+=" selected"}g+='>Story</option>\n          </select>\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label" for="tags">Tags</label>\n        <div class="controls">\n          ';var i=h.level.get("tags")||[];g+='\n          <input id="tags" class="input-large" type="text" value="'+((f=(i.join(", ")))==null?"":f)+'" placeholder="Comma-separated list of tags"/>\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label" for="flags">Flags</label>\n        <div class="controls">\n          ';var c=h.level.get("flags")||[];g+='\n          <input id="flags" class="input-large" type="text" value="'+((f=(c.join(", ")))==null?"":f)+'" placeholder="Comma-separated list of flags"/>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="level-owner">Owner</label>\n        <div class="controls">\n          <input id="level-owner" class="input-large" type="text" value="'+((f=(h.level.get("owner").username))==null?"":f)+'"/>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="levelData">Level Data</label>\n        <div class="controls"> \n            <input id="level-file" class="input-large" type="file" />\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="thumbnail">Thumbnail image</label>\n        <div class="controls"> \n            <input accept="image/*" id="level-thumbnail-file" class="input-large" type="file" />\n        </div>\n      </div>\n\n    </form>\n  </div>\n  <div class="span4">\n    <div class="thumbnail">\n        ';var d=h.level.has("thumbnails")?"https://"+h.level.get("thumbnails")["default"]:"/assets/images/placeholder_256.png";g+='\n        <img id="thumbnail-image" src="'+((f=(d))==null?"":f)+'" width=256 height=256/>\n        <ul class="caption unstyled">\n            ';var e={downloads:h.level.get("downloads"),likes:h.level.get("likes"),comments:h.level.get("comments"),plays:h.level.get("plays"),panics:h.level.get("panics")};g+='\n            <li>Downloads <span class="badge badge-inverse pull-right" title="Downloads">'+((f=(e.downloads))==null?"":f)+'</span>\n            <li>Likes <span class="badge badge-important pull-right" title="Likes">'+((f=(e.likes))==null?"":f)+'</span>\n            <li>Comments <span class="badge badge-success pull-right" title="Comments">'+((f=(e.comments))==null?"":f)+'</span>\n            <li>Games played <span class="badge badge-info pull-right" title="Games played">'+((f=(e.plays))==null?"":f)+'</span>\n            <li>Games panics <span class="badge badge-warning pull-right" title="Games played">'+((f=(e.panics))==null?"":f)+'</span>\n        </ul>\n    </div>\n  </div>\n</div>\n<div class="form-actions">\n  <button id="save-btn" class="btn btn-primary">Save changes</button>\n  <button id="cancel-btn" class="btn">Cancel</button>\n  <button id="delete-btn" class="btn btn-danger pull-right">Delete forever</button>\n</div>';return g};window.JST.users=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<section id="users">\n  <header>\n    <div class="pull-right">\n      <button id="refresh-btn" class="btn"><i class="icon-refresh"></i>Refresh</button>\n      <button id="new-user-btn" class="btn"><i class="icon-user"></i>New User</button>\n    </div>\n    <h1>Users <span id="users-total" class="muted hide"></span></h1>\n  </header>\n  <div class="row-fluid">\n    <div id="users-list" class="span8 panel-left"></div>\n    <form class="span4">\n      <div class="control-group">\n        <label class="control-label" for="filter-email">E-mail</label>\n        <div class="controls">\n          <input id="filter-email" class="input-large" type="text" value="'+((b=(c.filters.email))==null?"":b)+'" placeholder="bro@castle.com"/>\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label" for="filter-username">Username</label>\n        <div class="controls">\n          <input id="filter-username" class="input-large" type="text" value="'+((b=(c.filters.username))==null?"":b)+'" placeholder="brocoder"/>\n        </div>\n      </div>\n      <button id="filter-btn" class="btn btn-primary" type="button" style="width: 230px">Filter</button>\n    </form>\n  </div>\n</section>\n';return e};window.JST.side_nav=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<aside>\n  <nav>\n    <ul class="nav">\n      <li id="dashboard-view-sel">\n        <a href="/" data-c-uri=""><i class="icon-dashboard icon-white"></i> Dashboard</a>\n      </li>\n      <li id="levels-view-sel">\n        <a href="/levels" data-c-uri="levels"><i class="icon-th-list icon-white"></i> Levels</a>\n      </li>\n      <li id="users-view-sel">\n        <a href="/users" data-c-uri="users"><i class="icon-user icon-white"></i> Users</a>\n      </li>\n    </ul>\n  </nav>\n</aside>\n';return e};window.JST.levels=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<section id="levels">\n  <header>\n    <div class="pull-right">\n      <button id="levels-delete-btn" class="btn btn-danger">Delete</button>\n      <button id="refresh-btn" class="btn"><i class="icon-refresh"></i> Refresh</button>\n      <button id="new-level-btn" class="btn"><i class="icon-user"></i>New Level</button>\n    </div>\n    <h1>Levels <span id="levels-total" class="muted hide"></span></h1>\n  </header>\n  <div class="row-fluid">\n    <div id="levels-list" class="span8 panel-left"></div>\n    <form class="span4">\n\n\n      <div class="control-group">\n        <label class="control-label" for="filter-any">Any Search</label>\n        <div class="controls">\n          <input id="filter-any" class="input-large" type="text" value="'+((b=(c.filters.any))==null?"":b)+'" placeholder="text"/>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="filter-name">Name</label>\n        <div class="controls">\n          <input id="filter-name" class="input-large" type="text" value="'+((b=(c.filters.name))==null?"":b)+'" placeholder="name"/>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="filter-description">Description</label>\n        <div class="controls">\n          <input id="filter-description" class="input-large" type="text" value="'+((b=(c.filters.description))==null?"":b)+'" placeholder="description"/>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="filter-tags">Tags</label>\n        <div class="controls">\n          <input id="filter-tags" class="input-large" type="text" value="'+((b=(c.filters.tag))==null?"":b)+'" placeholder="tag1|tag2"/>\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label" for="filter-flags">Flags</label>\n        <div class="controls">\n          <input id="filter-flags" class="input-large" type="text" value="'+((b=(c.filters.flag))==null?"":b)+'" placeholder="flag1|flag2"/>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="filter-owner">Owner</label>\n        <div class="controls">\n          <input id="filter-owner" class="input-large" type="text" value="'+((b=(c.filters.owner_name))==null?"":b)+'" placeholder="type user name"/>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="filter-visibility">Visibility</label>\n        <div class="controls">\n          <select id="filter-visibility" class="input-large" style="width: 230px">\n            <option value="private|friends|public|story"';if(c.filters.visibility=="private|filter|public|story"){e+=" selected"}e+='>All</option>\n            <option value="private"';if(c.filters.visibility=="private"){e+=" selected"}e+='>Private</option>\n            <option value="friends"';if(c.filters.visibility=="friends"){e+=" selected"}e+='>Friends</option>\n            <option value="public"';if(c.filters.visibility=="public"){e+=" selected"}e+='>Public</option>\n            <option value="story"';if(c.filters.visibility=="story"){e+=" selected"}e+='>Story</option>\n          </select>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="filter-visibility">Sort By</label>\n        <div class="controls">\n          <select id="filter-sortby" class="input-large" style="width: 230px">\n            <option value="created"';if(c.filters.sortby=="created"){e+=" selected"}e+='>Created</option>\n            <option value="updated"';if(c.filters.sortby=="updated"){e+=" selected"}e+='>Updated</option>\n            <option value="tags"';if(c.filters.sortby=="tags"){e+=" selected"}e+='>Tags</option>\n            <option value="gameplay"';if(c.filters.sortby=="gameplay"){e+=" selected"}e+='>Gameplay</option>\n            <option value="flags"';if(c.filters.sortby=="flags"){e+=" selected"}e+='>Flags</option>\n            <option value="stats.comments"';if(c.filters.sortby=="stats.comments"){e+=" selected"}e+='>Comments</option>\n            <option value="stats.plays"';if(c.filters.sortby=="stats.plays"){e+=" selected"}e+='>Plays</option>\n            <option value="stats.downloads"';if(c.filters.sortby=="stats.downloads"){e+=" selected"}e+='>Downloads</option>\n            <option value="stats.likes"';if(c.filters.sortby=="stats.likes"){e+=" selected"}e+='>Likes</option>\n          </select>\n        </div>\n      </div>\n\n      <div class="control-group">\n        <label class="control-label" for="filter-visibility">Sort Order</label>\n        <div class="controls">\n          <select id="filter-sortorder" class="input-large" style="width: 230px">\n            <option value="-" ';if(c.filters.sortorder=="-"){e+=" selected"}e+='>Descending</option>\n            <option value=""';if(c.filters.sortorder==""){e+=" selected"}e+='>Ascending</option>\n          </select>\n        </div>\n      </div>\n\n\n\n      <button id="filter-btn" class="btn btn-primary" type="button" style="width: 230px">Filter</button>\n    </form>\n  </div>\n</section>\n';return e};window.JST.main_nav=function(c){var b,e="",a=Array.prototype.join,d=function(){e+=a.call(arguments,"")};e+='<div class="navbar navbar-static-top navbar-inverse">\n    <div class="navbar-inner">\n        <div class="container">\n            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">\n                <span class="icon-bar"></span>\n                <span class="icon-bar"></span>\n                <span class="icon-bar"></span>\n            </a>\n\n            <a class="brand" href="/">Castle</a>\n            <span class="tagline">Innovation in creation.</span>\n\n            <div class="nav-collapse collapse" id="main-menu">\n                <div class="auth pull-right">\n                    <img class="avatar" src="/assets/images/placeholder_40.png">\n                    <span class="name">'+((b=(c.user.name))==null?"":b)+'</span><br/>\n                    <span class="links">\n                        <!--<a id="settings-btn" href="#">Settings</a>-->\n                        <a id="logout-btn" href="#">Logout</a>\n                    </span>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n';return e};(function(){var e={};var l=this,n=l.async;e.noConflict=function(){l.async=n;return e};var g=function(p,r){if(p.forEach){return p.forEach(r)}for(var q=0;q<p.length;q+=1){r(p[q],q,p)}};var d=function(p,r){if(p.map){return p.map(r)}var q=[];g(p,function(s,u,t){q.push(r(s,u,t))});return q};var a=function(p,r,q){if(p.reduce){return p.reduce(r,q)}g(p,function(s,u,t){q=r(q,s,u,t)});return q};var k=function(r){if(Object.keys){return Object.keys(r)}var q=[];for(var p in r){if(r.hasOwnProperty(p)){q.push(p)}}return q};if(typeof process==="undefined"||!(process.nextTick)){e.nextTick=function(p){setTimeout(p,0)}}else{e.nextTick=process.nextTick}e.forEach=function(p,r,s){s=s||function(){};if(!p.length){return s()}var q=0;g(p,function(t){r(t,function(u){if(u){s(u);s=function(){}}else{q+=1;if(q===p.length){s(null)}}})})};e.forEachSeries=function(p,s,t){t=t||function(){};if(!p.length){return t()}var r=0;var q=function(){s(p[r],function(u){if(u){t(u);t=function(){}}else{r+=1;if(r===p.length){t(null)}else{q()}}})};q()};e.forEachLimit=function(p,r,u,w){w=w||function(){};if(!p.length||r<=0){return w()}var t=0;var q=0;var s=0;(function v(){if(t===p.length){return w()}while(s<r&&q<p.length){q+=1;s+=1;u(p[q-1],function(x){if(x){w(x);w=function(){}}else{t+=1;s-=1;if(t===p.length){w()}else{v()}}})}})()};var h=function(p){return function(){var q=Array.prototype.slice.call(arguments);return p.apply(null,[e.forEach].concat(q))}};var o=function(p){return function(){var q=Array.prototype.slice.call(arguments);return p.apply(null,[e.forEachSeries].concat(q))}};var m=function(s,p,r,t){var q=[];p=d(p,function(u,v){return{index:v,value:u}});s(p,function(u,v){r(u.value,function(x,w){q[u.index]=w;v(x)})},function(u){t(u,q)})};e.map=h(m);e.mapSeries=o(m);e.reduce=function(p,q,r,s){e.forEachSeries(p,function(t,u){r(q,t,function(x,w){q=w;u(x)})},function(t){s(t,q)})};e.inject=e.reduce;e.foldl=e.reduce;e.reduceRight=function(p,q,r,t){var s=d(p,function(u){return u}).reverse();e.reduce(s,q,r,t)};e.foldr=e.reduceRight;var j=function(s,p,r,t){var q=[];p=d(p,function(u,v){return{index:v,value:u}});s(p,function(u,v){r(u.value,function(w){if(w){q.push(u)}v()})},function(u){t(d(q.sort(function(w,v){return w.index-v.index}),function(v){return v.value}))})};e.filter=h(j);e.filterSeries=o(j);e.select=e.filter;e.selectSeries=e.filterSeries;var f=function(s,p,r,t){var q=[];p=d(p,function(u,v){return{index:v,value:u}});s(p,function(u,v){r(u.value,function(w){if(!w){q.push(u)}v()})},function(u){t(d(q.sort(function(w,v){return w.index-v.index}),function(v){return v.value}))})};e.reject=h(f);e.rejectSeries=o(f);var i=function(r,p,q,s){r(p,function(t,u){q(t,function(v){if(v){s(t);s=function(){}}else{u()}})},function(t){s()})};e.detect=h(i);e.detectSeries=o(i);e.some=function(p,q,r){e.forEach(p,function(s,t){q(s,function(u){if(u){r(true);r=function(){}}t()})},function(s){r(false)})};e.any=e.some;e.every=function(p,q,r){e.forEach(p,function(s,t){q(s,function(u){if(!u){r(false);r=function(){}}t()})},function(s){r(true)})};e.all=e.every;e.sortBy=function(p,q,r){e.map(p,function(s,t){q(s,function(u,v){if(u){t(u)}else{t(null,{value:s,criteria:v})}})},function(u,s){if(u){return r(u)}else{var t=function(y,x){var w=y.criteria,v=x.criteria;return w<v?-1:w>v?1:0};r(null,d(s.sort(t),function(v){return v.value}))}})};e.auto=function(w,v){v=v||function(){};var t=k(w);if(!t.length){return v(null)}var q={};var s=[];var p=function(x){s.unshift(x)};var r=function(y){for(var x=0;x<s.length;x+=1){if(s[x]===y){s.splice(x,1);return}}};var u=function(){g(s.slice(0),function(x){x()})};p(function(){if(k(q).length===t.length){v(null,q);v=function(){}}});g(t,function(y){var x=(w[y] instanceof Function)?[w[y]]:w[y];var C=function(E){if(E){v(E);v=function(){}}else{var D=Array.prototype.slice.call(arguments,1);if(D.length<=1){D=D[0]}q[y]=D;u()}};var A=x.slice(0,Math.abs(x.length-1))||[];var z=function(){return a(A,function(E,D){return(E&&q.hasOwnProperty(D))},true)&&!q.hasOwnProperty(y)};if(z()){x[x.length-1](C,q)}else{var B=function(){if(z()){r(B);x[x.length-1](C,q)}};p(B)}})};e.waterfall=function(r,q){q=q||function(){};if(!r.length){return q()}var p=function(s){return function(v){if(v){q(v);q=function(){}}else{var t=Array.prototype.slice.call(arguments,1);var u=s.next();if(u){t.push(p(u))}else{t.push(q)}e.nextTick(function(){s.apply(null,t)})}}};p(e.iterator(r))()};e.parallel=function(r,q){q=q||function(){};if(r.constructor===Array){e.map(r,function(s,t){if(s){s(function(v){var u=Array.prototype.slice.call(arguments,1);if(u.length<=1){u=u[0]}t.call(null,v,u)})}},q)}else{var p={};e.forEach(k(r),function(s,t){r[s](function(v){var u=Array.prototype.slice.call(arguments,1);if(u.length<=1){u=u[0]}p[s]=u;t(v)})},function(s){q(s,p)})}};e.series=function(r,q){q=q||function(){};if(r.constructor===Array){e.mapSeries(r,function(s,t){if(s){s(function(v){var u=Array.prototype.slice.call(arguments,1);if(u.length<=1){u=u[0]}t.call(null,v,u)})}},q)}else{var p={};e.forEachSeries(k(r),function(s,t){r[s](function(v){var u=Array.prototype.slice.call(arguments,1);if(u.length<=1){u=u[0]}p[s]=u;t(v)})},function(s){q(s,p)})}};e.iterator=function(q){var p=function(r){var s=function(){if(q.length){q[r].apply(null,arguments)}return s.next()};s.next=function(){return(r<q.length-1)?p(r+1):null};return s};return p(0)};e.apply=function(q){var p=Array.prototype.slice.call(arguments,1);return function(){return q.apply(null,p.concat(Array.prototype.slice.call(arguments)))}};var c=function(t,p,q,u){var s=[];t(p,function(v,r){q(v,function(w,x){s=s.concat(x||[]);r(w)})},function(r){u(r,s)})};e.concat=h(c);e.concatSeries=o(c);e.whilst=function(r,p,q){if(r()){p(function(s){if(s){return q(s)}e.whilst(r,p,q)})}else{q()}};e.until=function(r,p,q){if(!r()){p(function(s){if(s){return q(s)}e.until(r,p,q)})}else{q()}};e.queue=function(t,r){var p=0;var s={tasks:[],concurrency:r,saturated:null,empty:null,drain:null,push:function(q,u){if(q.constructor!==Array){q=[q]}g(q,function(v){s.tasks.push({data:v,callback:typeof u==="function"?u:null});if(s.saturated&&s.tasks.length==r){s.saturated()}e.nextTick(s.process)})},process:function(){if(p<s.concurrency&&s.tasks.length){var q=s.tasks.shift();if(s.empty&&s.tasks.length==0){s.empty()}p+=1;t(q.data,function(){p-=1;if(q.callback){q.callback.apply(q,arguments)}if(s.drain&&s.tasks.length+p==0){s.drain()}s.process()})}},length:function(){return s.tasks.length},running:function(){return p}};return s};var b=function(p){return function(r){var q=Array.prototype.slice.call(arguments,1);r.apply(null,q.concat([function(t){var s=Array.prototype.slice.call(arguments,1);if(typeof console!=="undefined"){if(t){if(console.error){console.error(t)}}else{if(console[p]){g(s,function(u){console[p](u)})}}}}]))}};e.log=b("log");e.dir=b("dir");e.memoize=function(t,r){var q={};var s={};r=r||function(u){return u};var p=function(){var u=Array.prototype.slice.call(arguments);var w=u.pop();var v=r.apply(null,u);if(v in q){w.apply(null,q[v])}else{if(v in s){s[v].push(w)}else{s[v]=[w];t.apply(null,u.concat([function(){q[v]=arguments;var z=s[v];delete s[v];for(var y=0,x=z.length;y<x;y++){z[y].apply(null,arguments)}}]))}}};p.unmemoized=t;return p};e.unmemoize=function(p){return function(){return(p.unmemoized||p).apply(null,arguments)}};if(typeof define!=="undefined"&&define.amd){define("async",[],function(){return e})}else{if(typeof module!=="undefined"&&module.exports){module.exports=e}else{l.async=e}}}());(function(){var ao=void 0,aj=!0,af=this;function H(k,K){var G=k.split("."),y=af;!(G[0] in y)&&y.execScript&&y.execScript("var "+G[0]);for(var B;G.length&&(B=G.shift());){!G.length&&K!==ao?y[B]=K:y=y[B]?y[B]:y[B]={}}}var D="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array;function A(k,y){this.index="number"===typeof y?y:0;this.f=0;this.buffer=k instanceof (D?Uint8Array:Array)?k:new (D?Uint8Array:Array)(32768);if(2*this.buffer.length<=this.index){throw Error("invalid index")}this.buffer.length<=this.index&&b(this)}function b(k){var K=k.buffer,G,y=K.length,B=new (D?Uint8Array:Array)(y<<1);if(D){B.set(K)}else{for(G=0;G<y;++G){B[G]=K[G]}}return k.buffer=B}A.prototype.a=function(y,S,P){var G=this.buffer,K=this.index,Q=this.f,B=G[K],k;P&&1<S&&(y=8<S?(v[y&255]<<24|v[y>>>8&255]<<16|v[y>>>16&255]<<8|v[y>>>24&255])>>32-S:v[y]>>8-S);if(8>S+Q){B=B<<S|y,Q+=S}else{for(k=0;k<S;++k){B=B<<1|y>>S-k-1&1,8===++Q&&(Q=0,G[K++]=v[B],B=0,K===G.length&&(G=b(this)))}}G[K]=B;this.buffer=G;this.f=Q;this.index=K};A.prototype.finish=function(){var k=this.buffer,B=this.index,y;0<this.f&&(k[B]<<=8-this.f,k[B]=v[k[B]],B++);D?y=k.subarray(0,B):(k.length=B,y=k);return y};var d=new (D?Uint8Array:Array)(256),t;for(t=0;256>t;++t){for(var s=t,q=s,ai=7,s=s>>>1;s;s>>>=1){q<<=1,q|=s&1,--ai}d[t]=(q<<ai&255)>>>0}var v=d;function L(k,P,G){var y,B="number"===typeof P?P:P=0,K="number"===typeof G?G:k.length;y=-1;for(B=K&7;B--;++P){y=y>>>8^o[(y^k[P])&255]}for(B=K>>3;B--;P+=8){y=y>>>8^o[(y^k[P])&255],y=y>>>8^o[(y^k[P+1])&255],y=y>>>8^o[(y^k[P+2])&255],y=y>>>8^o[(y^k[P+3])&255],y=y>>>8^o[(y^k[P+4])&255],y=y>>>8^o[(y^k[P+5])&255],y=y>>>8^o[(y^k[P+6])&255],y=y>>>8^o[(y^k[P+7])&255]}return(y^4294967295)>>>0}var o,g=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918000,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];o=D?new Uint32Array(g):g;function M(k){this.buffer=new (D?Uint16Array:Array)(2*k);this.length=0}M.prototype.getParent=function(k){return 2*((k-2)/4|0)};M.prototype.push=function(k,P){var G,y,B=this.buffer,K;G=this.length;B[this.length++]=P;for(B[this.length++]=k;0<G;){if(y=this.getParent(G),B[G]>B[y]){K=B[G],B[G]=B[y],B[y]=K,K=B[G+1],B[G+1]=B[y+1],B[y+1]=K,G=y}else{break}}return this.length};M.prototype.pop=function(){var k,P,G=this.buffer,y,B,K;P=G[0];k=G[1];this.length-=2;G[0]=G[this.length];G[1]=G[this.length+1];for(K=0;;){B=2*K+2;if(B>=this.length){break}B+2<this.length&&G[B+2]>G[B]&&(B+=2);if(G[B]>G[K]){y=G[K],G[K]=G[B],G[B]=y,y=G[K+1],G[K+1]=G[B+1],G[B+1]=y}else{break}K=B}return{index:k,value:P,length:this.length}};function i(X){var W=X.length,S=0,Y=Number.POSITIVE_INFINITY,Q,T,G,B,P,V,k,y,K;for(y=0;y<W;++y){X[y]>S&&(S=X[y]),X[y]<Y&&(Y=X[y])}Q=1<<S;T=new (D?Uint32Array:Array)(Q);G=1;B=0;for(P=2;G<=S;){for(y=0;y<W;++y){if(X[y]===G){V=0;k=B;for(K=0;K<G;++K){V=V<<1|k&1,k>>=1}for(K=V;K<Q;K+=P){T[K]=G<<16|y}++B}}++G;B<<=1;P<<=1}}function N(k,y){this.h=m;this.j=0;this.input=k;this.c=0;y&&(y.lazy&&(this.j=y.lazy),"number"===typeof y.compressionType&&(this.h=y.compressionType),y.outputBuffer&&(this.b=D&&y.outputBuffer instanceof Array?new Uint8Array(y.outputBuffer):y.outputBuffer),"number"===typeof y.outputIndex&&(this.c=y.outputIndex));this.b||(this.b=new (D?Uint8Array:Array)(32768))}var m=2,l=[],j;for(j=0;288>j;j++){switch(aj){case 143>=j:l.push([j+48,8]);break;case 255>=j:l.push([j-144+400,9]);break;case 279>=j:l.push([j-256+0,7]);break;case 287>=j:l.push([j-280+192,8]);break;default:throw"invalid literal: "+j}}N.prototype.g=function(){var bb,a9,a6,bc,a5=this.input;switch(this.h){case 0:a6=0;for(bc=a5.length;a6<bc;){a9=D?a5.subarray(a6,a6+65535):a5.slice(a6,a6+65535);a6+=a9.length;var a7=a9,a0=a6===bc,aZ=ao,a4=ao,a8=ao,aS=ao,aX=ao,a2=this.b,aU=this.c;if(D){for(a2=new Uint8Array(this.b.buffer);a2.length<=aU+a7.length+5;){a2=new Uint8Array(a2.length<<1)}a2.set(this.b)}aZ=a0?1:0;a2[aU++]=aZ|0;a4=a7.length;a8=~a4+65536&65535;a2[aU++]=a4&255;a2[aU++]=a4>>>8&255;a2[aU++]=a8&255;a2[aU++]=a8>>>8&255;if(D){a2.set(a7,aU),aU+=a7.length,a2=a2.subarray(0,aU)}else{aS=0;for(aX=a7.length;aS<aX;++aS){a2[aU++]=a7[aS]}a2.length=aU}this.c=aU;this.b=a2}break;case 1:var ax=new A(new Uint8Array(this.b.buffer),this.c);ax.a(1,1,aj);ax.a(1,2,aj);var aQ=al(this,a5),aL,Y,aK;aL=0;for(Y=aQ.length;aL<Y;aL++){if(aK=aQ[aL],A.prototype.a.apply(ax,l[aK]),256<aK){ax.a(aQ[++aL],aQ[++aL],aj),ax.a(aQ[++aL],5),ax.a(aQ[++aL],aQ[++aL],aj)}else{if(256===aK){break}}}this.b=ax.finish();this.c=this.b.length;break;case m:var aN=new A(new Uint8Array(this.b),this.c),aI,a3,aV,ay,az,k=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G,aR,aG,aC,aH,aJ=Array(19),B,y,aB,aw,aT;aI=m;aN.a(1,1,aj);aN.a(aI,2,aj);a3=al(this,a5);G=R(this.n,15);aR=p(G);aG=R(this.m,7);aC=p(aG);for(aV=286;257<aV&&0===G[aV-1];aV--){}for(ay=30;1<ay&&0===aG[ay-1];ay--){}var aD=aV,K=ay,W=new (D?Uint32Array:Array)(aD+K),aP,T,aO,aA,X=new (D?Uint32Array:Array)(316),au,av,S=new (D?Uint8Array:Array)(19);for(aP=T=0;aP<aD;aP++){W[T++]=G[aP]}for(aP=0;aP<K;aP++){W[T++]=aG[aP]}if(!D){aP=0;for(aA=S.length;aP<aA;++aP){S[aP]=0}}aP=au=0;for(aA=W.length;aP<aA;aP+=T){for(T=1;aP+T<aA&&W[aP+T]===W[aP];++T){}aO=T;if(0===W[aP]){if(3>aO){for(;0<aO--;){X[au++]=0,S[0]++}}else{for(;0<aO;){av=138>aO?aO:138,av>aO-3&&av<aO&&(av=aO-3),10>=av?(X[au++]=17,X[au++]=av-3,S[17]++):(X[au++]=18,X[au++]=av-11,S[18]++),aO-=av}}}else{if(X[au++]=W[aP],S[W[aP]]++,aO--,3>aO){for(;0<aO--;){X[au++]=W[aP],S[W[aP]]++}}else{for(;0<aO;){av=6>aO?aO:6,av>aO-3&&av<aO&&(av=aO-3),X[au++]=16,X[au++]=av-3,S[16]++,aO-=av}}}}bb=D?X.subarray(0,au):X.slice(0,au);aH=R(S,7);for(aw=0;19>aw;aw++){aJ[aw]=aH[k[aw]]}for(az=19;4<az&&0===aJ[az-1];az--){}B=p(aH);aN.a(aV-257,5,aj);aN.a(ay-1,5,aj);aN.a(az-4,4,aj);for(aw=0;aw<az;aw++){aN.a(aJ[aw],3,aj)}aw=0;for(aT=bb.length;aw<aT;aw++){if(y=bb[aw],aN.a(B[y],aH[y],aj),16<=y){aw++;switch(y){case 16:aB=2;break;case 17:aB=3;break;case 18:aB=7;break;default:throw"invalid code: "+y}aN.a(bb[aw],aB,aj)}}var aW=[aR,G],aE=[aC,aG],P,Q,bd,aM,aY,aF,V,a1;aY=aW[0];aF=aW[1];V=aE[0];a1=aE[1];P=0;for(Q=a3.length;P<Q;++P){if(bd=a3[P],aN.a(aY[bd],aF[bd],aj),256<bd){aN.a(a3[++P],a3[++P],aj),aM=a3[++P],aN.a(V[aM],a1[aM],aj),aN.a(a3[++P],a3[++P],aj)}else{if(256===bd){break}}}this.b=aN.finish();this.c=this.b.length;break;default:throw"invalid compression type"}return this.b};function am(k,y){this.length=k;this.k=y}function U(){var k=r;switch(aj){case 3===k:return[257,k-3,0];case 4===k:return[258,k-4,0];case 5===k:return[259,k-5,0];case 6===k:return[260,k-6,0];case 7===k:return[261,k-7,0];case 8===k:return[262,k-8,0];case 9===k:return[263,k-9,0];case 10===k:return[264,k-10,0];case 12>=k:return[265,k-11,1];case 14>=k:return[266,k-13,1];case 16>=k:return[267,k-15,1];case 18>=k:return[268,k-17,1];case 22>=k:return[269,k-19,2];case 26>=k:return[270,k-23,2];case 30>=k:return[271,k-27,2];case 34>=k:return[272,k-31,2];case 42>=k:return[273,k-35,3];case 50>=k:return[274,k-43,3];case 58>=k:return[275,k-51,3];case 66>=k:return[276,k-59,3];case 82>=k:return[277,k-67,4];case 98>=k:return[278,k-83,4];case 114>=k:return[279,k-99,4];case 130>=k:return[280,k-115,4];case 162>=k:return[281,k-131,5];case 194>=k:return[282,k-163,5];case 226>=k:return[283,k-195,5];case 257>=k:return[284,k-227,5];case 258===k:return[285,k-258,0];default:throw"invalid length: "+k}}var an=[],r,Z;for(r=3;258>=r;r++){Z=U(),an[r]=Z[2]<<24|Z[1]<<16|Z[0]}var u=D?new Uint32Array(an):an;function al(aG,aF){function aC(aP,aO){var aQ=aP.k,aM=[],aK=0,aL;aL=u[aP.length];aM[aK++]=aL&65535;aM[aK++]=aL>>16&255;aM[aK++]=aL>>24;var aN;switch(aj){case 1===aQ:aN=[0,aQ-1,0];break;case 2===aQ:aN=[1,aQ-2,0];break;case 3===aQ:aN=[2,aQ-3,0];break;case 4===aQ:aN=[3,aQ-4,0];break;case 6>=aQ:aN=[4,aQ-5,1];break;case 8>=aQ:aN=[5,aQ-7,1];break;case 12>=aQ:aN=[6,aQ-9,2];break;case 16>=aQ:aN=[7,aQ-13,2];break;case 24>=aQ:aN=[8,aQ-17,3];break;case 32>=aQ:aN=[9,aQ-25,3];break;case 48>=aQ:aN=[10,aQ-33,4];break;case 64>=aQ:aN=[11,aQ-49,4];break;case 96>=aQ:aN=[12,aQ-65,5];break;case 128>=aQ:aN=[13,aQ-97,5];break;case 192>=aQ:aN=[14,aQ-129,6];break;case 256>=aQ:aN=[15,aQ-193,6];break;case 384>=aQ:aN=[16,aQ-257,7];break;case 512>=aQ:aN=[17,aQ-385,7];break;case 768>=aQ:aN=[18,aQ-513,8];break;case 1024>=aQ:aN=[19,aQ-769,8];break;case 1536>=aQ:aN=[20,aQ-1025,9];break;case 2048>=aQ:aN=[21,aQ-1537,9];break;case 3072>=aQ:aN=[22,aQ-2049,10];break;case 4096>=aQ:aN=[23,aQ-3073,10];break;case 6144>=aQ:aN=[24,aQ-4097,11];break;case 8192>=aQ:aN=[25,aQ-6145,11];break;case 12288>=aQ:aN=[26,aQ-8193,12];break;case 16384>=aQ:aN=[27,aQ-12289,12];break;case 24576>=aQ:aN=[28,aQ-16385,13];break;case 32768>=aQ:aN=[29,aQ-24577,13];break;default:throw"invalid distance"}aL=aN;aM[aK++]=aL[0];aM[aK++]=aL[1];aM[aK++]=aL[2];var aJ,aI;aJ=0;for(aI=aM.length;aJ<aI;++aJ){ay[X++]=aM[aJ]}S[aM[0]]++;P[aM[3]]++;T=aP.length+aO-1;av=null}var aH,aB,aD,ax,aw,aA={},aE,W,av,ay=D?new Uint16Array(2*aF.length):[],X=0,T=0,S=new (D?Uint32Array:Array)(286),P=new (D?Uint32Array:Array)(30),K=aG.j,G;if(!D){for(aD=0;285>=aD;){S[aD++]=0}for(aD=0;29>=aD;){P[aD++]=0}}S[256]=1;aH=0;for(aB=aF.length;aH<aB;++aH){aD=aw=0;for(ax=3;aD<ax&&aH+aD!==aB;++aD){aw=aw<<8|aF[aH+aD]}aA[aw]===ao&&(aA[aw]=[]);aE=aA[aw];if(!(0<T--)){for(;0<aE.length&&32768<aH-aE[0];){aE.shift()}if(aH+3>=aB){av&&aC(av,-1);aD=0;for(ax=aB-aH;aD<ax;++aD){G=aF[aH+aD],ay[X++]=G,++S[G]}break}if(0<aE.length){var Q=ao,B=ao,az=0,au=ao,V=ao,Y=ao,k=ao,y=aF.length,V=0,k=aE.length;aH:for(;V<k;V++){Q=aE[k-V-1];au=3;if(3<az){for(Y=az;3<Y;Y--){if(aF[Q+Y-1]!==aF[aH+Y-1]){continue aH}}au=az}for(;258>au&&aH+au<y&&aF[Q+au]===aF[aH+au];){++au}au>az&&(B=Q,az=au);if(258===au){break}}W=new am(az,aH-B);av?av.length<W.length?(G=aF[aH-1],ay[X++]=G,++S[G],aC(W,0)):aC(av,-1):W.length<K?av=W:aC(W,0)}else{av?aC(av,-1):(G=aF[aH],ay[X++]=G,++S[G])}}aE.push(aH)}ay[X++]=256;S[256]++;aG.n=S;aG.m=P;return D?ay.subarray(0,X):ay}function R(aE,aD){function aA(aH){var aG=G[aH][B[aH]];aG===Y?(aA(aH+1),aA(aH+1)):--Q[aG];++B[aH]}var aF=aE.length,az=new M(572),aB=new (D?Uint8Array:Array)(aF),av,au,ay,aC,T;if(!D){for(aC=0;aC<aF;aC++){aB[aC]=0}}for(aC=0;aC<aF;++aC){0<aE[aC]&&az.push(aC,aE[aC])}av=Array(az.length/2);au=new (D?Uint32Array:Array)(az.length/2);if(1===av.length){return aB[az.pop().index]=1,aB}aC=0;for(T=az.length/2;aC<T;++aC){av[aC]=az.pop(),au[aC]=av[aC].value}var Y=au.length,aw=new (D?Uint16Array:Array)(aD),V=new (D?Uint8Array:Array)(aD),Q=new (D?Uint8Array:Array)(Y),P=Array(aD),G=Array(aD),B=Array(aD),y=(1<<aD)-Y,K=1<<aD-1,k,ax,X,S,W;aw[aD-1]=Y;for(ax=0;ax<aD;++ax){y<K?V[ax]=0:(V[ax]=1,y-=K),y<<=1,aw[aD-2-ax]=(aw[aD-1-ax]/2|0)+Y}aw[0]=V[0];P[0]=Array(aw[0]);G[0]=Array(aw[0]);for(ax=1;ax<aD;++ax){aw[ax]>2*aw[ax-1]+V[ax]&&(aw[ax]=2*aw[ax-1]+V[ax]),P[ax]=Array(aw[ax]),G[ax]=Array(aw[ax])}for(k=0;k<Y;++k){Q[k]=aD}for(X=0;X<aw[aD-1];++X){P[aD-1][X]=au[X],G[aD-1][X]=X}for(k=0;k<aD;++k){B[k]=0}1===V[aD-1]&&(--Q[0],++B[aD-1]);for(ax=aD-2;0<=ax;--ax){S=k=0;W=B[ax+1];for(X=0;X<aw[ax];X++){S=P[ax+1][W]+P[ax+1][W+1],S>au[k]?(P[ax][X]=S,G[ax][X]=Y,W+=2):(P[ax][X]=au[k],G[ax][X]=k,++k)}B[ax]=0;1===V[ax]&&aA(ax)}ay=Q;aC=0;for(T=av.length;aC<T;++aC){aB[av[aC].index]=ay[aC]}return aB}function p(S){var Q=new (D?Uint16Array:Array)(S.length),K=[],T=[],G=0,P,y,k,B;P=0;for(y=S.length;P<y;P++){K[S[P]]=(K[S[P]]|0)+1}P=1;for(y=16;P<=y;P++){T[P]=G,G+=K[P]|0,G<<=1}P=0;for(y=S.length;P<y;P++){G=T[S[P]];T[S[P]]+=1;k=Q[P]=0;for(B=S[P];k<B;k++){Q[P]=Q[P]<<1|G&1,G>>>=1}}return Q}function ak(k,y){this.input=k;this.c=this.i=0;this.d={};y&&(y.flags&&(this.d=y.flags),"string"===typeof y.filename&&(this.filename=y.filename),"string"===typeof y.comment&&(this.l=y.comment),y.deflateOptions&&(this.e=y.deflateOptions));this.e||(this.e={})}ak.prototype.g=function(){var Y,X,T,au,S,V,K,G,Q=new (D?Uint8Array:Array)(32768),W=0,k=this.input,B=this.i,P=this.filename,y=this.l;Q[W++]=31;Q[W++]=139;Q[W++]=8;Y=0;this.d.fname&&(Y|=O);this.d.fcomment&&(Y|=n);this.d.fhcrc&&(Y|=aa);Q[W++]=Y;X=(Date.now?Date.now():+new Date)/1000|0;Q[W++]=X&255;Q[W++]=X>>>8&255;Q[W++]=X>>>16&255;Q[W++]=X>>>24&255;Q[W++]=0;Q[W++]=w;if(this.d.fname!==ao){K=0;for(G=P.length;K<G;++K){V=P.charCodeAt(K),255<V&&(Q[W++]=V>>>8&255),Q[W++]=V&255}Q[W++]=0}if(this.d.comment){K=0;for(G=y.length;K<G;++K){V=y.charCodeAt(K),255<V&&(Q[W++]=V>>>8&255),Q[W++]=V&255}Q[W++]=0}this.d.fhcrc&&(T=L(Q,0,W)&65535,Q[W++]=T&255,Q[W++]=T>>>8&255);this.e.outputBuffer=Q;this.e.outputIndex=W;S=new N(k,this.e);Q=S.g();W=S.c;D&&(W+8>Q.buffer.byteLength?(this.b=new Uint8Array(W+8),this.b.set(new Uint8Array(Q.buffer)),Q=this.b):Q=new Uint8Array(Q.buffer));au=L(k,ao,ao);Q[W++]=au&255;Q[W++]=au>>>8&255;Q[W++]=au>>>16&255;Q[W++]=au>>>24&255;G=k.length;Q[W++]=G&255;Q[W++]=G>>>8&255;Q[W++]=G>>>16&255;Q[W++]=G>>>24&255;this.i=B;D&&W<Q.length&&(this.b=Q=Q.subarray(0,W));return Q};var w=255,aa=2,O=8,n=16;H("Zlib.Gzip",ak);H("Zlib.Gzip.prototype.compress",ak.prototype.g);var ap=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];D&&new Uint16Array(ap);var ab=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];D&&new Uint16Array(ab);var z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];D&&new Uint8Array(z);var aq=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];D&&new Uint16Array(aq);var ac=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];D&&new Uint8Array(ac);var C=new (D?Uint8Array:Array)(288),h,ar;h=0;for(ar=C.length;h<ar;++h){C[h]=143>=h?8:255>=h?9:279>=h?7:8}i(C);var ad=new (D?Uint8Array:Array)(30),x,E;x=0;for(E=ad.length;x<E;++x){ad[x]=5}i(ad);var at=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];D&&new Uint16Array(at);var ae=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];D&&new Uint16Array(ae);var F=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];D&&new Uint8Array(F);var a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];D&&new Uint16Array(a);var ag=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];D&&new Uint8Array(ag);var I=new (D?Uint8Array:Array)(288),f,c;f=0;for(c=I.length;f<c;++f){I[f]=143>=f?8:255>=f?9:279>=f?7:8}i(I);var ah=new (D?Uint8Array:Array)(30),J,e;J=0;for(e=ah.length;J<e;++J){ah[J]=5}i(ah)}).call(this);var Model,PaginatedCollection,View,collections,castle,models,views,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d},__indexOf=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++){if(b in this&&this[b]===c){return b}}return -1};castle={};castle.config={API_URL:"https://staging.console.castle.com"};castle.Router=(function(b){__extends(a,b);function a(){this.hLevel=__bind(this.hLevel,this);this.hLevels=__bind(this.hLevels,this);this.hUserLevels=__bind(this.hUserLevels,this);this.hUser=__bind(this.hUser,this);this.hUsers=__bind(this.hUsers,this);this.hIndex=__bind(this.hIndex,this);this.hForbidden=__bind(this.hForbidden,this);this.hSignIn=__bind(this.hSignIn,this);this.hSignUp=__bind(this.hSignUp,this);return a.__super__.constructor.apply(this,arguments)}a.prototype.routes={"":"hIndex","sign-up":"hSignUp","sign-in":"hSignIn",forbidden:"hForbidden",users:"hUsers","users/:id":"hUser","users/:id/levels":"hUserLevels",levels:"hLevels","levels/:id":"hLevel"};a.prototype.initialize=function(c){this.app=c;return this.$root=$("#root")};a.prototype.route=function(d,e,c){var f=this;return a.__super__.route.call(this,d,e,function(){var g;g=c!=null?c:f[e];f.trigger("route:@before");f.before(d,e);g.apply(f,arguments);f.after(d,e);return f.trigger("route:@after")})};a.prototype.before=function(d,e){var c,f;if(!(this.app.context.get("access_token")!=null)){this.app.context.set("next",d!=="sign-up"&&d!=="sign-in"?d:"");if(d!=="sign-up"&&d!=="sign-in"&&d!=="forbidden"){return this.navigate("sign-in",{trigger:true})}}else{c=this.app.context.get("user");if(__indexOf.call(c.roles,"admin")<0){return this.navigate("forbidden",{trigger:true})}if(!(this.view!=null)||!(this.view instanceof castle.views.RootView)){if((f=this.view)!=null){f.destroy()}return this.view=(new castle.views.RootView({app:this.app})).appendTo(this.$root)}}};a.prototype.after=function(c,d){};a.prototype.hSignUp=function(){var c;if((c=this.view)!=null){c.destroy()}return this.view=(new castle.views.SignUpView({app:this.app})).appendTo(this.$root)};a.prototype.hSignIn=function(){var c;if((c=this.view)!=null){c.destroy()}return this.view=(new castle.views.SignInView({app:this.app})).appendTo(this.$root)};a.prototype.hForbidden=function(){var c;if((c=this.view)!=null){c.destroy()}return this.view=(new castle.views.ForbiddenView({app:this.app})).appendTo(this.$root)};a.prototype.hIndex=function(){return this.view.showContent("dashboard")};a.prototype.hUsers=function(){return this.view.showContent("users")};a.prototype.hUser=function(c){return this.view.showContent("user",{userId:c})};a.prototype.hUserLevels=function(c){return this.view.showContent("levels",{filters:{owner:c}})};a.prototype.hLevels=function(){return this.view.showContent("levels")};a.prototype.hLevel=function(c){return this.view.showContent("level",{levelId:c})};return a})(Backbone.Router);castle.Context=(function(){function a(){}a.prototype.set=function(b,c){if(c===void 0){throw new Error("Cannot set value to undefined")}if(!_.isString(c)){c=JSON.stringify(c)}localStorage[b]=c;return this};a.prototype.get=function(b){var d,c;if(!(b in localStorage)){return void 0}d=localStorage[b];if((c=d[0])==="{"||c==="["){try{d=JSON.parse(d)}catch(f){}}return d};a.prototype["delete"]=function(b){if(b in localStorage){delete localStorage[b]}return this};a.prototype.hasKey=function(b){return b in localStorage};return a})();castle.EventBus=(function(){function a(){_.extend(this,Backbone.Events)}return a})();castle.Application=(function(){function a(){this.eventBus=new castle.EventBus;this.router=new castle.Router(this);this.context=new castle.Context;this.config=castle.config}a.prototype.run=function(){var b,c;c=Backbone.sync;b=this.context;Backbone.sync=function(g,e,d){var f;f=d.beforeSend;d.beforeSend=function(i){var h;h=b.get("access_token");if(h!=null){i.setRequestHeader("X-Castle-Auth",h)}if(f!=null){return f(i)}};return c(g,e,d)};return Backbone.history.start({pushState:true})};return a})();castle.models=models={};Model=models.Model=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.resource="object";b.prototype.urlRoot=function(){return castle.config.API_URL+this.ROOT_URL};b.prototype.fetch=function(c){var d,e=this;c=c!=null?_.clone(c):{};if(!(c.parse!=null)){c.parse=true}d=c.success;c.success=function(g,f,i){var h;h=g[e.resource];if(!e.set(e.parse(h,c))){return false}if(d!=null){return d(e,h,c)}};return this.sync("read",this,c)};b.prototype._computeChanges=function(m){var g,k,h,f,l,j,c,d,e;this.changed={};g={};j=[];h=this._currentAttributes;k=this._changes;for(f=d=e=k.length-2;d>=0;f=d+=-2){l=k[f];c=k[f+1];if(g[l]){continue}g[l]=true;if(!_.isEqual(h[l],c)){this.changed[l]=c;if(!m){continue}j.push(l,c);h[l]=c}}if(m){this._changes=[]}this._hasComputed=true;return j};return b})(Backbone.Model);models.User=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.ROOT_URL="/v1/users";b.prototype.resource="user";return b})(Model);models.Level=(function(b){__extends(a,b);function a(){return a.__super__.constructor.apply(this,arguments)}a.prototype.ROOT_URL="/v1/levels";a.prototype.resource="level";a.prototype.fetchWithoutData=function(c){c=c!=null?c:{};return this.fetch(c)};return a})(Model);castle.collections=collections={};PaginatedCollection=collections.PaginatedCollection=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.resource="objects";b.prototype.initialize=function(h,d){var e,c,g,f;b.__super__.initialize.call(this,h,d);this.pagination={currentPage:(e=d!=null?d.currentPage:void 0)!=null?e:1,perPage:(c=d!=null?d.perPage:void 0)!=null?c:15};this.search=(g=d!=null?d.search:void 0)!=null?g:{};return this.populate=(f=d!=null?d.populate:void 0)!=null?f:[]};b.prototype.parse=function(c,d){this.pagination.currentPage=c.page;this.pagination.perPage=c.per_page;this.pagination.itemsTotal=c.total;this.pagination.pagesTotal=Math.ceil(this.pagination.itemsTotal/this.pagination.perPage);return c[this.resource]};b.prototype.fetch=function(c){var e,d,f=this;if(c==null){c={}}this.trigger("fetching");e=c.success;c.success=function(g){f.trigger("fetched");if(e!=null){return e(g)}};c.data=(d=c.data)!=null?d:{};c.data=_.extend(c.data,{page:this.pagination.currentPage,per_page:this.pagination.perPage,cacheInvalidateList:c.cacheInvalidateList},this.search,{populate:this.populate.length?this.populate.join(","):void 0});return b.__super__.fetch.call(this,c)};b.prototype.url=function(){return castle.config.API_URL+this.ROOT_URL};b.prototype.page=function(d,c){switch(d){case"next":this.pagination.currentPage=(this.pagination.currentPage%this.pagination.pagesTotal)+1;break;case"previous":this.pagination.currentPage=(this.pagination.currentPage-1)||this.pagination.pagesTotal;break;default:this.pagination.currentPage=d}this.fetch(c);return this};return b})(Backbone.Collection);collections.UsersCollection=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.ROOT_URL="/v1/users";b.prototype.resource="users";b.prototype.model=castle.models.User;return b})(PaginatedCollection);collections.LevelsCollection=(function(b){__extends(a,b);function a(){return a.__super__.constructor.apply(this,arguments)}a.prototype.ROOT_URL="/v1/levels";a.prototype.resource="levels";a.prototype.model=castle.models.Level;return a})(PaginatedCollection);castle.views=views={};View=views.View=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.initialize=function(c){var d;b.__super__.initialize.call(this,c);this.app=c.app;this.parent=(d=c.parent)!=null?d:null;this.children={};return this.render()};b.prototype.rerender=function(){this.undelegateEvents();this.render();this.delegateEvents();return this};b.prototype.destroy=function(){var e,c,d;d=this.children;for(e in d){c=d[e];c.destroy()}this.remove();return this};b.prototype.update=function(c){return this};b.prototype.appendTo=function(d){var f,c,e;d.append(this.$el);this.delegateEvents();e=this.children;for(f in e){c=e[f];c.delegateEvents()}return this};return b})(Backbone.View);views.SignInView=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.template=JST.sign_in;b.prototype.events={"click #sign-up-btn":function(c){c.preventDefault();return this.app.router.navigate("sign-up",{trigger:true})},"click #sign-in-btn":function(d){var e,c,f,g=this;d.preventDefault();this.$submit.prop("disabled",true);this.$alert.fadeOut();e={grant_type:"password",password:this.$password.val()};c=this.$login.val();f=__indexOf.call(c,"@")>=0?"email":"username";e[f]=c;return $.ajax(""+this.app.config.API_URL+"/v1/auth",{type:"POST",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",success:function(h){g.app.context.set("access_token",h.access_token);g.app.context.set("user",h.user);return g.app.router.navigate(g.app.context.get("next"),{trigger:true})},error:function(h){try{e=JSON.parse(h.responseText);if(e.error.type==="AUTH_FAILED"){return g.alert("Wrong username/e-mail and password combination.")}console.log("Authentication failed: ",h)}catch(i){console.log("Failed to parse response: ",h)}return g.alert("Unexpected error occured. Please refresh the page and try again.")},complete:function(){return g.$submit.prop("disabled",false)}})}};b.prototype.render=function(){var c;c={};this.$el.html(this.template(c));this.$alert=this.$el.find("#sign-in-alert");this.$login=this.$el.find("#login");this.$password=this.$el.find("#password");this.$submit=this.$el.find("#sign-in-btn");return this};b.prototype.alert=function(c){this.$alert.html(c);return this.$alert.fadeIn()};return b})(View);views.SignUpView=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.template=JST.sign_up;b.prototype.events={"click #sign-in-btn":function(c){c.preventDefault();return this.app.router.navigate("sign-in",{trigger:true})},"click #sign-up-btn":function(d){var e,c,g,f=this;d.preventDefault();this.$alert.fadeOut();c=this.$email.val();g=this.$username.val();if(c===""&&g===""){return this.alert("E-mail and username cannot be empty")}this.$submit.prop("disabled",true);e={password:this.$password.val()};if(c!==""){e.email=c}if(g!==""){e.username=g}return $.ajax(""+this.app.config.API_URL+"/v1/users",{type:"POST",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",success:function(h){f.app.context.set("access_token",h.access_token);f.app.context.set("user",h.user);return f.app.router.navigate("",{trigger:true})},error:function(k){var l,n,j,i,h;try{e=JSON.parse(k.responseText);l=e.error.type;if(l==="USER_EXISTS"){h=(function(){var p,o;p=e.error.data.properties;o=[];for(n in p){i=p[n];o.push(i)}return o})();h=h.join(", ");return f.alert("User with given credentials already exists ("+h+")")}if(l==="VALIDATION_ERROR"){j=(function(){var p,o;p=e.error.data.properties;o=[];for(n in p){i=p[n];o.push(n)}return o})();j=j.join(", ");return f.alert("Provided values are not valid ("+j+")")}console.log("Failed to create new user account: ",k)}catch(m){console.log("Failed to parse response: ",k)}return f.alert("Unexpected error occured. Please refresh the page and try again.")},complete:function(){return f.$submit.prop("disabled",false)}})}};b.prototype.render=function(){var c;c={};this.$el.html(this.template(c));this.$alert=this.$el.find("#sign-up-alert");this.$email=this.$el.find("#email");this.$username=this.$el.find("#username");this.$password=this.$el.find("#password");this.$submit=this.$el.find("#sign-up-btn");return this};b.prototype.alert=function(c){this.$alert.html(c);return this.$alert.fadeIn()};return b})(View);views.ForbiddenView=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.template=JST.forbidden;b.prototype.events={"click #sign-in-btn":function(c){c.preventDefault();return this.app.router.navigate("sign-in",{trigger:true})},"click #sign-up-btn":function(c){c.preventDefault();return this.app.router.navigate("sign-up",{trigger:true})}};b.prototype.render=function(){var c;c={};this.$el.html(this.template(c));return this};return b})(View);views.RootView=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.template=JST.main;b.prototype.cache={};b.prototype.navigation={user:"users",level:"levels"};b.prototype.initialize=function(c){var d=this;b.__super__.initialize.call(this,c);this.app.eventBus.on("notification",function(e,g,f){return d.children.toast.show(e,g,f,2000)});this.app.eventBus.on("showInfo",function(e,g,f){return d.children.toast.show(e,g,f,null)});return this.app.eventBus.on("hideInfo",function(e,g,f){return d.children.toast.hide()})};b.prototype.render=function(){var c;c={};this.$el.html(this.template(c));this.$content=this.$el.find("#content");this.$topNav=this.$el.find("#top-nav");this.$sideNav=this.$el.find("#side-nav");this.$toast=this.$el.find("#toast");this.children={topNav:(new views.TopNavView({app:this.app,parent:this})).appendTo(this.$topNav),sideNav:(new views.SideNavView({app:this.app,parent:this})).appendTo(this.$sideNav),toast:(new views.ToastView({app:this.app,parent:this})).appendTo(this.$toast)};return this};b.prototype.showContent=function(e,d){var f,g,c;if(this.children.content!=null){this.children.content.remove()}if(e in this.cache){this.children.content=this.cache[e].appendTo(this.$content).update(d)}else{f=""+(_.str.capitalize(_.str.camelize(e)))+"View";c=_.extend({app:this.app,parent:this},d);this.children.content=this.cache[e]=(new views[f](c)).appendTo(this.$content)}g=e in this.navigation?this.navigation[e]:e;return this.children.sideNav.select(g)};return b})(View);views.ToastView=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.template=JST.toast;b.prototype.className="hide";b.prototype.render=function(d,f,e){var c;c={type:d!=null?d:"warning",title:f!=null?f:null,content:e!=null?e:null};this.$el.html(this.template(c));return this};b.prototype.hide=function(){return this.$el.hide()};b.prototype.show=function(c,f,d,e){var g=this;this.render(c,f,d);this.$el.show();if(e!=null){setTimeout(function(){return g.$el.hide()},e)}return this};return b})(View);views.SideNavView=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.template=JST.side_nav;b.prototype.current=null;b.prototype.events={"click li a":function(e){var c,d;e.preventDefault();d=$(e.currentTarget).data("c-uri");c=this.app.router.routes[d];this.app.router.navigate(d);return this.app.router[c]()}};b.prototype.render=function(){var c;c={};this.$el.html(this.template(c));return this};b.prototype.select=function(c){this.$el.find(".nav li").removeClass("selected");this.current=this.$el.find("#"+c+"-view-sel");this.current.addClass("selected");return this};return b})(View);views.TopNavView=(function(b){__extends(a,b);function a(){return a.__super__.constructor.apply(this,arguments)}a.prototype.template=JST.main_nav;a.prototype.events={"click #settings-btn":function(c){c.preventDefault();return alert("I'm working on it, bro!")},"click #logout-btn":function(c){c.preventDefault();this.app.context["delete"]("access_token")["delete"]("user");return this.app.router.navigate("sign-in",{trigger:true})}};a.prototype.render=function(){var c,d;d=this.app.context.get("user");c={user:{name:d.username!=null?d.username:d.email}};this.$el.html(this.template(c));return this};return a})(View);views.DashboardView=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.template=JST.dashboard;b.prototype.events={"click #refresh-btn":function(c){return this.rerender()}};b.prototype.render=function(){var c=this;this.fetchStats(function(d){if(c.children.levelsStats!=null){c.children.levelsStats.remove()}return c.children.levelsStats=(new views.LevelsStatsView({stats:d,app:c.app,parent:c})).appendTo(c.$levelsStats)});this.$el.html(this.template({}));this.$levelsStats=this.$el.find("#levels-stats");return this};b.prototype.fetchStats=function(f,d){var c,e,g=this;c=this.app.context.get("access_token");e=this.app.config.API_URL;return async.parallel({levels:function(h){return $.getJSON(""+e+"/v1/levels/stats",{access_token:c},function(i){return h(null,i)})},users:function(h){return $.getJSON(""+e+"/v1/users/stats",{access_token:c},function(i){return h(null,i)})}},function(i,h){var j;if((j=i!=null?i.length:void 0)!==(void 0)&&j!==0){console.log(i);if(d!=null){return d(i)}}return f({levels:h.levels,users:h.users})})};return b})(View);views.LevelsStatsView=(function(b){__extends(a,b);function a(){return a.__super__.constructor.apply(this,arguments)}a.prototype.template=JST.levels_stats;a.prototype.events={"click .level-link":function(c){c.preventDefault();return this.app.router.navigate($(c.currentTarget).data("c-uri"),{trigger:true})}};a.prototype.initialize=function(c){this._stats=c.stats;return a.__super__.initialize.call(this,c)};a.prototype.render=function(){var c;c={stats:this._stats};this.$el.html(this.template(c));return this};return a})(View);views.NewUserDialog=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.template=JST.user_new_dialog;b.prototype.initialize=function(c){this.collection=c.collection||[];return b.__super__.initialize.call(this,c)};b.prototype.events={"click #user-new-close-btn":function(c){$("#new-user-btn").prop("disabled",false);return this.remove()},"click #user-new-create-btn":function(e){var i,f,c,d,h,g=this;e.preventDefault();this.$alert.fadeOut();c=this.$email.val();h=this.$username.val();if(c===""||h===""){return this.alert("E-mail and username cannot be empty")}d=[];$("#user-new-roles  .btn.active").each(function(j,k){return d.push(k.value)});if(d.length===0){return this.alert("Please select roles")}this.$submit.prop("disabled",true);f={password:this.$password.val(),roles:d};if(c!==""){f.email=c}if(h!==""){f.username=h}i=this.app.context.get("access_token");return $.ajax(""+this.app.config.API_URL+"/v1/users",{type:"POST",data:JSON.stringify(f),contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:function(j){return j.setRequestHeader("X-Castle-Auth",i)},success:function(j){g.collection.add(j.user);g.app.router.navigate("users",{trigger:true});g.remove();return $("#new-user-btn").prop("disabled",false)},error:function(m){var n,q,l,k,j;try{f=JSON.parse(m.responseText);n=f.error.type;if(n==="USER_EXISTS"){j=(function(){var r,p;r=f.error.data.properties;p=[];for(q in r){k=r[q];p.push(k)}return p})();j=j.join(", ");return g.alert("User with given credentials already exists ("+j+")")}if(n==="VALIDATION_ERROR"){l=(function(){var r,p;r=f.error.data.properties;p=[];for(q in r){k=r[q];p.push(q)}return p})();l=l.join(", ");return g.alert("Provided values are not valid ("+l+")")}console.log("Failed to create new user account: ",m)}catch(o){console.log("Failed to parse response: ",m)}return g.alert("Unexpected error occured. Please refresh the page and try again.")},complete:function(){return g.$submit.prop("disabled",false)}})}};b.prototype.render=function(){this.$el.html(this.template({}));this.$alert=this.$el.find("#user-new-alert");this.$email=this.$el.find("#email");this.$username=this.$el.find("#username");this.$password=this.$el.find("#password");this.$submit=this.$el.find("#user-new-create-btn");return this};b.prototype.alert=function(c){this.$alert.html(c);this.$alert.fadeIn();return this};b.prototype.show=function(){($("#root")).append(this.$el);return this.$el.show()};return b})(View);views.UsersView=(function(b){__extends(a,b);function a(){return a.__super__.constructor.apply(this,arguments)}a.prototype.template=JST.users;a.prototype.initialize=function(c){this._filters={};return a.__super__.initialize.call(this,c)};a.prototype.events={"click #refresh-btn":function(c){this._filters={};return this.rerender()},"click #new-user-btn":function(d){var c;$("#new-user-btn").prop("disabled",true);c=new views.NewUserDialog({collection:this.collection,app:this.app,parent:this});return c.show()},"click #filter-btn":function(f){var c,d,e,g;c=this.$el.find("#filter-email");d=this.$el.find("#filter-username");e=c.val();g=d.val();this._filters={email:e!==""?e:void 0,username:g!==""?g:void 0};return this.rerender()}};a.prototype.render=function(){var c=this;if(this.collection!=null){this.collection.stopListening()}this.collection=new castle.collections.UsersCollection(null,{search:{email:this._filters.email,username:this._filters.username}});this.collection.on("add",function(d){return c.setUsersInfo(c.collection)});this.collection.on("remove",function(d){return c.rerender()});this.collection.fetch({update:true,success:function(){if(c.children.usersList!=null){c.children.usersList.remove()}c.children.usersList=(new views.UsersListView({collection:c.collection,app:c.app,parent:c})).appendTo(c.$usersList);return c.$usersTotal.show()}});this.$el.html(this.template({filters:this._filters}));this.$usersList=this.$el.find("#users-list");this.$usersTotal=this.$el.find("#users-total");return this};a.prototype.setUsersInfo=function(c){return this.$usersTotal.html("("+c.length+"/"+c.pagination.itemsTotal+")")};return a})(View);views.UsersListView=(function(b){__extends(a,b);function a(){return a.__super__.constructor.apply(this,arguments)}a.prototype.templates={list:JST.users_list,item:JST.users_list_item};a.prototype.initialize=function(c){var d=this;a.__super__.initialize.call(this,c);this.collection.on("add",function(e){return d.$list.append($(d.templates.item({user:e})))});this.app.eventBus.on("users.model.destroy",function(e){return d.collection.remove(e)});return this.app.eventBus.on("users.model.update",function(f){var g,e,h;d.collection.update(f);g=d.$list.find("#user-"+f.id);e=f.get("email");h=f.get("username");g.find(".login").html((h!=null?h:e));return g.find(".login-secondary").html(((h!=null)&&(e!=null)?"("+e+")":""))})};a.prototype.events={"click .media-list a":function(c){c.preventDefault();return this.app.router.navigate($(c.currentTarget).data("c-uri"),{trigger:true})},"click #more-btn":function(c){this.collection.page("next",{update:true,remove:false});if(this.collection.pagination.currentPage===this.collection.pagination.pagesTotal){return $(c.currentTarget).hide()}}};a.prototype.render=function(){var c;c={users:this.collection,templates:{item:this.templates.item}};this.$el.html(this.templates.list(c));this.$list=this.$el.find(".media-list");return this};return a})(View);views.UserView=(function(b){__extends(a,b);function a(){return a.__super__.constructor.apply(this,arguments)}a.prototype.template=JST.user;a.prototype.initialize=function(c){this.userId=c.userId;return a.__super__.initialize.call(this,c)};a.prototype.render=function(){var c,d,e=this;c={user:{id:this.userId}};this.$el.html(this.template(c));this.$userEdit=this.$el.find("#user-edit");d=new castle.models.User({id:this.userId});d.fetch({success:function(){if(e.children.userEdit!=null){e.children.userEdit.remove()}return e.children.userEdit=(new views.UserEditView({model:d,app:e.app,parent:e})).appendTo(e.$userEdit)}});return this};a.prototype.update=function(c){this.userId=c.userId;return this.render()};return a})(View);views.UserEditView=(function(b){__extends(a,b);function a(){return a.__super__.constructor.apply(this,arguments)}a.prototype.template=JST.user_edit;a.prototype.events={"click #save-btn":function(f){var g,d,c,j,e,i,h=this;e=this.$roles.val();i=this.$username.val();c=this.$password.val();d=this.$email.val();g={username:i!==""?i:void 0,email:d!==""?d:void 0,roles:e!==""?(function(){var n,l,m,k;m=e.split(",");k=[];for(n=0,l=m.length;n<l;n++){j=m[n];k.push(_.str.trim(j))}return k})():[]};if(c!==""){g.password=c}this.app.eventBus.trigger("notification","warning",null,"Updating user...",null);return this.model.save(g,{success:function(l,k){h.app.eventBus.trigger("users.model.update",h.model);return h.app.eventBus.trigger("notification","success",null,"User has been updated.")},error:function(o,t){var r,u,k,q,m,s,n,l;m=JSON.parse(t.responseText);r=m.error;u="Failed to update user.";switch(r.type){case"USER_EXISTS":q=[];n=r.data.properties;for(k in n){s=n[k];q.push(""+k+":"+s)}u="User ["+(q.join(", "))+"] already exists";break;case"VALIDATION_ERROR":q=[];l=r.data.properties;for(k in l){s=l[k];q.push(""+k+":"+s)}u="Validation failed for properties ["+q+"]";break;default:console.log(m)}return h.app.eventBus.trigger("notification","error",null,u,3000)}})},"click #cancel-btn":function(c){return this.app.router.navigate("users",{trigger:true})},"click #delete-btn":function(c){var d=this;this.app.eventBus.trigger("notification","warning",null,"Removing level...",null);this.model.destroy({success:function(f,e){d.app.eventBus.trigger("users.model.destroy",d.model);return d.app.eventBus.trigger("notification","success",null,"User has been removed.")}});return this.app.router.navigate("users",{trigger:true})}};a.prototype.render=function(){var c;c={user:this.model};this.$el.html(this.template(c));this.$username=this.$el.find("#username");this.$password=this.$el.find("#password");this.$email=this.$el.find("#email");this.$roles=this.$el.find("#roles");return this};return a})(View);views.LevelsView=(function(b){__extends(a,b);function a(){return a.__super__.constructor.apply(this,arguments)}a.prototype.template=JST.levels;a.prototype.initialize=function(c){var d;c=c!=null?c:{};this._filters=c.app.context.get("level_filters")||{};this.isUserMode=false;if(!this._filters){this._filters=(d=c.filters)!=null?d:{}}this.cacheInvalidateList=false;return a.__super__.initialize.call(this,c)};a.prototype.events={"click #refresh-btn":function(c){return this.rerender()},"click #levels-delete-btn":function(e){var c,d,f;d=[];c=this;f=function(g){return function(h){var i=this;return g.destroy({success:function(k,j){return h(null,k)}})}};$("#levels-list  .checkbox").each(function(g,h){if(h.checked){return d.push(f(new castle.models.Level({id:h.value})))}});if(d.length===0){return}if(!confirm("Do you want to delete levels ?")){return}this.app.eventBus.trigger("notification","warning",null,"Removing levels...",null);return async.series(d,function(h,j){var k,i,g;for(i=0,g=j.length;i<g;i++){k=j[i];c.app.eventBus.trigger("levels.model.destroy",k)}c.app.eventBus.trigger("notification","success",null,"Levels removed.");return c.app.router.navigate("levels",{trigger:true})})},"click #new-level-btn":function(d){var c;$("#new-level-btn").prop("disabled",true);c=new views.NewLevelDialog({collection:this.collection,app:this.app,parent:this});return c.show()},"click #filter-btn":function(l){var h,i,o,c,f,p,q,k,j,g,n,m,e,s,r,d;q=this.$el.find("#filter-tags");o=this.$el.find("#filter-flags");k=this.$el.find("#filter-visibility");c=this.$el.find("#filter-name");i=this.$el.find("#filter-description");f=this.$el.find("#filter-sortby");p=this.$el.find("#filter-sortorder");h=this.$el.find("#filter-any");r=q.val();r=r!==""?(function(){var w,u,v,t;v=r.split(",");t=[];for(w=0,u=v.length;w<u;w++){s=v[w];t.push(_.str.trim(s))}return t})():[];g=o.val();g=g!==""?(function(){var w,u,v,t;v=g.split(",");t=[];for(w=0,u=v.length;w<u;w++){j=v[w];t.push(_.str.trim(j))}return t})():[];d=k.val();m=f.val();e=p.val();this._filters=_.extend(this._filters,{tag:r.length?r.join("|"):void 0,flag:g.length?g.join("|"):void 0,visibility:d,sortby:m,sortorder:e,description:i.val(),name:c.val(),any:h.val()});n=this.$owner.val();if(n===""&&!this.isUserMode){delete this._filters.owner;delete this._filters.owner_name}if(this.$selectedOwnerId){this._filters.owner=this.$selectedOwnerId;this._filters.owner_name=this.$selectedOwnerName;this.$selectedOwnerId=null}if(!this.isUserMode){this.app.context.set("level_filters",this._filters)}return this.rerender()}};a.prototype.render=function(){var c,d=this;if(this.collection!=null){this.collection.stopListening()}this.collection=new castle.collections.LevelsCollection(null,{search:{tag:this._filters.tag,flag:this._filters.flag,visibility:this._filters.visibility,owner:this._filters.owner,sortBy:this._filters.sortorder!=null?this._filters.sortorder+this._filters.sortby:"-created",description:this._filters.description,name:this._filters.name,any:this._filters.any},populate:["owner"]});this.collection.on("add",function(e){return d.setLevelsInfo(d.collection)});this.collection.on("remove",function(e){d.cacheInvalidateList=true;return d.rerender()});this.collection.fetch({update:true,cacheInvalidateList:this.cacheInvalidateList,success:function(){if(d.children.levelsList!=null){d.children.levelsList.remove()}d.cacheInvalidateList=false;d.children.levelsList=(new views.LevelsListView({collection:d.collection,app:d.app,parent:d})).appendTo(d.$levelsList);return d.$levelsTotal.show()}});this.$el.html(this.template({filters:this._filters}));this.$levelsList=this.$el.find("#levels-list");this.$levelsTotal=this.$el.find("#levels-total");c=this;this.$owner=this.$el.find("#filter-owner");this.$owner.autocomplete({minLength:2,appendTo:this.$el,select:function(e,f){c.$selectedOwnerId=f.item.id;c.$selectedOwnerName=f.item.label;return c.$selectedOwnerEmail=f.item.email},source:function(f,e){var g;g=d.app.context.get("access_token");return $.getJSON((""+d.app.config.API_URL+"/v1/users?username=")+f.term,{access_token:g},function(h){var i=this;return e($.map(h.users,function(j){return{label:j.username,value:j.username,id:j.id,email:j.email}}))})}}).autocomplete("widget").css("z-index",2000);if(this.isUserMode){this.$owner.prop("disabled",true)}else{this.$owner.prop("disabled",false)}return this};a.prototype.setLevelsInfo=function(c){return this.$levelsTotal.html("("+c.length+"/"+c.pagination.itemsTotal+")")};a.prototype.update=function(c){c=c!=null?c:{};if(c.filters&&c.filters.owner){this._filters=c.filters;this.isUserMode=true}else{this.isUserMode=false;this._filters=this.app.context.get("level_filters")||{}}return this.rerender()};return a})(View);views.LevelsListView=(function(b){__extends(a,b);function a(){return a.__super__.constructor.apply(this,arguments)}a.prototype.templates={list:JST.levels_list,item:JST.levels_list_item};a.prototype.initialize=function(c){var d=this;a.__super__.initialize.call(this,c);this.selToggle=false;this.collection.on("add",function(e){d.$list.append($(d.templates.item({level:e})));return d.rerender()});this.app.eventBus.on("levels.model.destroy",function(e){d.collection.remove(e);d.$list.find("#level-"+e.id).remove();return d.rerender()});return this.app.eventBus.on("levels.model.update",function(e){var f;d.collection.update(e);f=d.$list.find("#level-"+e.id);f.find(".name").html(e.get("name"));f.find(".description").html(e.get("description"));return d.rerender()})};a.prototype.events={"click .media-list a":function(c){c.preventDefault();return this.app.router.navigate($(c.currentTarget).data("c-uri"),{trigger:true})},"click #levels-select-all-btn":function(e){var d,c;this.selToggle=!this.selToggle;c=this;d=this.$el.find("#levels-select-all-btn");if(c.selToggle){d.innnerHTML="Select All"}else{d.innnerHTML="Deselect All"}return $("#levels-list  .checkbox").each(function(f,g){if(c.selToggle){return g.setAttribute("checked","checked")}else{return g.removeAttribute("checked")}})},"click #more-btn":function(c){this.collection.page("next",{update:true,remove:false});if(this.collection.pagination.currentPage===this.collection.pagination.pagesTotal){return $(c.currentTarget).hide()}}};a.prototype.render=function(){var c;c={levels:this.collection,templates:{item:this.templates.item}};this.$el.html(this.templates.list(c));this.$list=this.$el.find(".media-list");return this};return a})(View);views.LevelView=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.template=JST.level;b.prototype.initialize=function(c){this.levelId=c.levelId;return b.__super__.initialize.call(this,c)};b.prototype.render=function(){var c,e,d=this;c={level:{id:this.levelId}};this.$el.html(this.template(c));this.$levelEdit=this.$el.find("#level-edit");e=new castle.models.Level({id:this.levelId});e.fetchWithoutData({success:function(){if(d.children.levelEdit!=null){d.children.levelEdit.remove()}return d.children.levelEdit=(new views.LevelEditView({model:e,app:d.app,parent:d})).appendTo(d.$levelEdit)}});return this};b.prototype.update=function(c){this.levelId=c.levelId;return this.render()};return b})(View);views.LevelEditView=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.template=JST.level_edit;b.prototype.events={"click #save-btn":function(h){var e,g,d,c,i,k,j,f=this;j=this.$tags.val();d=this.$flags.val();c=this.model.get("owner")||{};i=c.displayname||c.username;e={name:this.$name.val(),description:this.$description.val(),gameplay:this.$gameplay.val(),visibility:this.$visibility.val(),tags:j!==""?(function(){var o,m,n,l;n=j.split(",");l=[];for(o=0,m=n.length;o<m;o++){k=n[o];l.push(_.str.trim(k))}return l})():[],flags:d!==""?(function(){var o,m,n,l;n=d.split(",");l=[];for(o=0,m=n.length;o<m;o++){g=n[o];l.push(_.str.trim(g))}return l})():[]};if(this.$thumbnailData){e.imageData=this.$thumbnailData}if(this.$dataLevel){e.data=this.$dataLevel}if(this.$selectedOwnerId){e.owner_id=this.$selectedOwnerId;e.owner={id:this.$selectedOwnerId,username:this.$selectedOwnerName,email:this.$selectedOwnerEmail};i=this.$selectedOwnerDisplayname||this.$selectedOwnerName}e.owner_display_name=i;this.app.eventBus.trigger("notification","warning",null,"Updating level...",null);return this.model.save(e,{success:function(m,l){f.app.eventBus.trigger("levels.model.update",f.model);f.app.eventBus.trigger("notification","success",null,"Level has been updated.");return f.rerender()}})},"click #cancel-btn":function(c){return this.app.router.navigate("levels",{trigger:true})},"click #delete-btn":function(c){var d=this;c.preventDefault();this.app.eventBus.trigger("notification","warning",null,"Removing level...",null);return this.model.destroy({success:function(f,e){d.app.eventBus.trigger("levels.model.destroy",d.model);d.app.eventBus.trigger("notification","success",null,"Level has been removed.");return d.app.router.navigate("levels",{trigger:true})}})}};b.prototype.render=function(){var c,d,e=this;c={level:this.model};this.$el.html(this.template(c));this.$name=this.$el.find("#name");this.$description=this.$el.find("#description");this.$gameplay=this.$el.find("#gameplay");this.$visibility=this.$el.find("#visibility");this.$tags=this.$el.find("#tags");this.$flags=this.$el.find("#flags");this.$file=this.$el.find("#level-file");d=this;this.$owner=this.$el.find("#level-owner");this.$owner.autocomplete({minLength:2,appendTo:this.$el,select:function(f,g){d.$selectedOwnerId=g.item.id;d.$selectedOwnerName=g.item.label;d.$selectedOwnerEmail=g.item.email;return d.$selectedOwnerDisplayname=g.item.displayname},source:function(g,f){var h;h=e.app.context.get("access_token");return $.getJSON((""+e.app.config.API_URL+"/v1/users?username=")+g.term,{access_token:h},function(i){var j=this;return f($.map(i.users,function(k){return{label:k.username,value:k.username,id:k.id,email:k.email,displayname:k.displayname}}))})}}).autocomplete("widget").css("z-index",2000);this.$file.bind("change",function(g){var h,f;f=new FileReader();h=g.target.files[0].name;f.onload=function(m){var r,p,q,j,k,o,l,n;if(m.target.readyState===FileReader.DONE){j=f.result;r=new Array(j.length);for(o=l=0,n=j.length;0<=n?l<n:l>n;o=0<=n?++l:--l){r[o]=j.charCodeAt(o)&255}k=new Zlib.Gzip(r,{filename:h});q=k.compress();p=btoa(String.fromCharCode.apply(null,q));return d.$dataLevel=p}};return f.readAsBinaryString(g.target.files[0])});this.$thumbnailFile=this.$el.find("#level-thumbnail-file");this.$thumbnailFile.bind("change",function(g){var f;f=new FileReader();f.onload=function(){return d.$thumbnailData=f.result.match(/,(.*)$/)[1]};return f.readAsDataURL(g.target.files[0])});return this};return b})(View);views.NewLevelDialog=(function(a){__extends(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}b.prototype.template=JST.level_new_dialog;b.prototype.initialize=function(c){this.collection=c.collection||[];return b.__super__.initialize.call(this,c)};b.prototype.events={"click #level-new-close-btn":function(c){$("#new-level-btn").prop("disabled",false);return this.remove()},"click #level-new-create-btn":function(I){var E,P,F,u,O,n,B,q,w,D,M,r,A,C,p,x,J,Q,l,d,c,z,K,y,v,H,t,N,L,s,G,o,m,k,j,h,g,f,e;I.preventDefault();this.$alert.fadeOut();this.app.eventBus.trigger("showInfo","warning",null,"Creating level...",null);t="private";$("#level-visibility  .btn.active").each(function(i,R){return t=R.value});l=this.$name.val();n=this.$description.val();w=this.$gameplay.val();y=this.$tags.val();q=this.$flags.val();if(l===""){return this.alert("Name cannot be empty")}p=$("#new-level-form");E=this.app.context.get("access_token");c=[];d=this;z=function(T,R,i,S){return function(U){var V=this;d.app.eventBus.trigger("showInfo","warning",null,"start sending level "+i+" of "+S+" name : "+R+"...",null);return $.ajax(""+d.app.config.API_URL+"/v1/levels",{type:"POST",data:JSON.stringify(T),contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:function(W){return W.setRequestHeader("X-Castle-Auth",E)},success:function(W){d.app.eventBus.trigger("showInfo","warning",null,"end sending level "+i+" of "+S+" name : "+R+"...",null);return U(null,[W,T])},error:function(W){var X;try{T=JSON.parse(W.responseText);X=T.error.type;console.log("Failed to create new level: ",W)}catch(Y){console.log("Failed to parse response: ",W)}d.alert("Unexpected error occured. Please refresh the page and try again.");return U(W,null)},complete:function(){return d.$submit.prop("disabled",false)}})}};v=d.levelDataUploadList.length;G=d.levelDataUploadList;for(r=N=0,s=G.length;N<s;r=++N){H=G[r];Q=H[0];A=H[1].data;x=H[1].image;J=H[1].meta||{};u=Q;this.app.eventBus.trigger("showInfo","warning",null,"start gziping level "+Q+"...",null);P=new Array(A.length);for(M=L=0,o=A.length;0<=o?L<o:L>o;M=0<=o?++L:--L){P[M]=A.charCodeAt(M)&255}D=new Zlib.Gzip(P,{filename:Q});F=D.compress();C=btoa(String.fromCharCode.apply(null,F));q=(m=J.flags)!=null?m:q;y=(k=J.tags)!=null?k:y;O={castle_id:(j=J.castleId)!=null?j:u,name:(h=J.name)!=null?h:l,description:(g=J.description)!=null?g:n,gameplay:(f=J.gameplay)!=null?f:w,tags:y!==""?(function(){var T,R,S,i;S=y.split(",");i=[];for(T=0,R=S.length;T<R;T++){K=S[T];i.push(_.str.trim(K))}return i})():[],flags:q!==""?(function(){var T,R,S,i;S=q.split(",");i=[];for(T=0,R=S.length;T<R;T++){B=S[T];i.push(_.str.trim(B))}return i})():[],visibility:(e=J.visibility)!=null?e:t,data:C};if(d.$selectedOwnerId){O.owner_id=d.$selectedOwnerId;O.owner_display_name=d.$selectedOwnerDisplayname}else{if(J.owner!=null){O.owner_id=J.owner.id;O.owner_display_name=J.owner.displayname}else{return this.alert("Can not find owner: "+J.ownerUsername)}}if(x){O.imageData=x}if(v>1&&!J.name){O.name=l+("-"+Q);O.description=n+("[ imported form "+Q+".xml ]")}c.push(z(O,Q,r,v))}return async.series(c,function(U,S){var V,W,T,R,i;d.app.router.navigate("levels",{trigger:true});i=[];for(T=0,R=S.length;T<R;T++){V=S[T];O=V[0];W=V[1];O.level.name=W.name;O.level.description=W.description;if(d.$selectedOwnerName){O.level.owner.username=d.$selectedOwnerName}if(d.$selectedOwnerEmail){O.level.owner.email=d.$selectedOwnerEmail}if(d.$selectedOwnerDisplayname){O.level.owner.display_name=d.$selectedOwnerDisplayname}d.collection.add(O.level);$("#new-level-btn").prop("disabled",false);d.app.eventBus.trigger("hideInfo");i.push(d.remove())}return i})}};b.prototype.render=function(){var c,d=this;this.$el.html(this.template({}));this.$alert=this.$el.find("#level-new-alert");this.$submit=this.$el.find("#level-new-create-btn");this.$name=this.$el.find("#level-name");this.$description=this.$el.find("#level-description");this.$gameplay=this.$el.find("#level-gameplay");this.$visibility=this.$el.find("#level-visibility");this.$tags=this.$el.find("#level-tags");this.$flags=this.$el.find("#level-flags");this.$file=this.$el.find("#level-file");c=this;this.$owner=this.$el.find("#level-owner");this.$owner.autocomplete({minLength:2,appendTo:this.$el,select:function(e,f){c.$selectedOwnerId=f.item.id;c.$selectedOwnerName=f.item.label;c.$selectedOwnerEmail=f.item.email;return c.$selectedDisplayname=f.item.displayname},source:function(f,e){var g;g=d.app.context.get("access_token");return $.getJSON((""+d.app.config.API_URL+"/v1/users?username=")+f.term,{access_token:g},function(h){var i=this;return e($.map(h.users,function(j){return{label:j.username,value:j.username,id:j.id,email:j.email,displayname:j.displayname}}))})}}).autocomplete("widget").css("z-index",2000);this.$file.bind("change",function(g){var f,j,k,i,e,h;j=[];k=function(l){return function(n){var m;m=new FileReader();m.onload=function(o){if(o.target.readyState===FileReader.DONE){return n(null,[m,l])}};if(l.type.match("image.*")){return m.readAsDataURL(l)}else{if(l.type.match(".*xml")){return m.readAsBinaryString(l)}}}};h=g.target.files;for(i=0,e=h.length;i<e;i++){f=h[i];j.push(k(f))}return async.series(j,function(q,x){var y,v,w,C,E,m,J,p,G,K,A,B,F,D,L,o,I,H,r,u,t,s,z,l,n,M;u={};for(n=0,M=x.length;n<M;n++){D=x[n];l=D[0];f=D[1];L=f.name;H=L.split(".");if(H.length===0){continue}I=H[0].substr(-1);o=H[0].slice(0,-1);if(!u[o]){u[o]={}}if(f.type.match("image.*")){u[o].image=l.result.match(/,(.*)$/)[1]}else{if(I==="d"){u[o].data=l.result}else{if(I==="m"){z={};if(l.result!=null){t=$.parseXML(l.result);t=$(t);E=t.find("Id");if(E!=null){z.objId=E.text()}p=t.find("OwnerId");if(typeof OwnerObj!=="undefined"&&OwnerObj!==null){z.ownerId=OwnerObj.text()}z.owner=null;G=t.find("Owner");if(G!=null){z.ownerUsername=G.text()}if(z.ownerUsername){$.getJSON((""+c.app.config.API_URL+"/v1/users?username=")+z.ownerUsername,{access_token:c.app.context.get("access_token")},function(N){z.owner=N.users[0];return c.$owner.val(z.owner.username||"")})}B=t.find("CastleId");if(B!=null){z.castleId=B.text()}v=t.find("Description");if(v!=null){z.description=v.text()}J=t.find("Name");if(J!=null){z.name=J.text()}C=t.find("Gameplay");if(C!=null){z.gameplay=C.text()}A=t.find("Visibility");if(A!=null){z.visibility=A.text()}$("#level-visibility  .btn.active").each(function(N,O){return $(O).removeClass("active")});$("#level-visibility  .btn").each(function(N,O){if(z.visibility===O.value){return $(O).addClass("active")}});z.tags=[];t.find("Tags").find("string").each(function(N,O){return z.tags.push($(this).text())});z.tags=z.tags.join(",");z.flags=[];t.find("Flags").find("string").each(function(N,O){return z.flags.push($(this).text())});z.flags=z.flags.join(",");y=t.find("Comments");if(y!=null){z.comments=y.text()}K=t.find("Plays");if(K!=null){z.plays=K.text()}m=t.find("Likes");if(m!=null){z.likes=m.text()}w=t.find("Downloads");if(w!=null){F=w.text()}z.PanicsObj=t.find("Panics");if(typeof PanicsObj!=="undefined"&&PanicsObj!==null){z.Panics=PanicsObj.text()}u[o].meta=z}}}}}c.levelDataUploadList=[];for(s in u){r=u[s];if(!r.data){continue}c.levelDataUploadList.push([s,r])}if(c.levelDataUploadList.length>0&&(c.levelDataUploadList[0][1].meta!=null)){z=c.levelDataUploadList[0][1].meta;c.$name.val(z.name);c.$description.val(z.description);c.$gameplay.val(z.gameplay);c.$tags.val(z.tags);c.$flags.val(z.flags)}if(c.levelDataUploadList.length!==0){return c.$submit.prop("disabled",false)}})});c.$submit.attr("disabled","true");return this};b.prototype.alert=function(c){this.$alert.html(c);this.$alert.fadeIn();return this};b.prototype.show=function(){($("#root")).append(this.$el);return this.$el.show()};return b})(View);$(function(){var a;a=new castle.Application;return a.run()});